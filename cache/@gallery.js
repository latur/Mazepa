function ivEncodeEntities(t){return $("<div/>").text(t).html()}function ivDecodeEntities(t){return $("<div/>").html(t).text()}function FixWidth(t,i,n,e){var o=n||80,e=e||0;$(t).each(function(){var t=$(this),n=t.width()-1,r=t.find(i),a=parseInt(n/o)+1;if(a>r.length)return!0;var c=n/a-2*e;r.css({width:c+"px",height:c+"px"}),t.css({minHeight:c*parseInt(r.length/a)-1})}),console.log("Выровнено! =)")}var host="mazepa.us",hard="//hard.mazepa.us",token=token||"",api=api||"/root/library/",Library=function(t,i){var n=!1;return function(e,o,r){return n?void console.log("> Множественные запросы запрещены"):(n=!0,void $.post(i+e,$.extend({token:t},o||{}),function(i){return n=!1,"object"==typeof i?(t=i.token||!1,t||console.log("> Ошибка: token не найден"),void("function"==typeof r&&r(i))):void console.log("> Некорректен формат ответа сервера")},"json"))}}(token,api),Templates=function(t){var i={};return $(t).each(function(){i[$(this).attr("id")]=$(this).remove().html()}),function(t,n){var n=n||{},e=i[t]||"";for(var o in n){var r=new RegExp("{"+o+"}","g");e=e.replace(r,n[o])}return e}}(".template"),Modal=function(){var t=function(){return $(".msg, .black").remove(),!1},i=function(i,n,e){$("body").append('<div class="black"></div><div class="box msg"></div>');var e=parseInt(e||300);100>e&&(e=300),e>$(window).width()-40&&(e=$(window).width()-40),$(".black").click(t).fadeIn(300);var o=$(".msg").append(i||"<h2>Modal</h2>").addClass("animation-jelly");o.css({width:e,marginLeft:-e/2,top:"50%",marginTop:-o.height()/2-15}),(n||function(){})(o)};return{Open:i,Close:t}}(),Picture=function(){var t=function(t){if(!t)return[0,0];var i=t.split(".").slice(-2,-1)[0],n=t.split(".").slice(-3,-2)[0],e=(i.indexOf("x")>=0?i:n).split("x"),o=[e[0]||1,e[1]||1];return o},i=function(i){var n=t(i);return n[0]>$(window).width()||n[1]>$(window).height()},n=function(t){return t.src_small&&i(t.src_small)?hard+t.src_small:t.src_medium&&i(t.src_medium)?hard+t.src_medium:t.src_large&&i(t.src_large)?hard+t.src_large:hard+t.src_main},e=function(i){var e=t(n(i)),o={W:e[0]||1,H:e[1]||1,padding:e[2]||0},r=o.W/o.H,a={W:$(window).width(),H:$(window).height()},c={top:0,left:0,height:o.H,width:o.W},s=r>a.W/(a.H-o.padding);return(1.5*o.W>a.W||1.5*o.H>a.H)&&(s?(c.height=a.W/r,c.width=a.W):(c.width=(a.H-o.padding)*r,c.height=a.H-o.padding)),c.top=(a.H-o.padding-(c.height||o.H))/2,c.left=(a.W-(c.width||o.W))/2,c};return{Src:n,CSS:e,Size:t}}(),Stack=function(){var t={};return function(i,n){if(i){var e=i.toString();t[e]&&clearInterval(t[e].timeout),t[e]={timer:n||500},t[e].timeout=setInterval(function(){return t[e].timer>0?t[e].timer-=50:(clearInterval(t[e].timeout),void i())},50)}}}(),OAuth=function(){var t="https://"+host+"/login/oauth?type=",i={vk:["https://oauth.vk.com/authorize?client_id=4560732","display=popup","scope=friends","redirect_uri="+t+"vk","response_type=code"].join("&"),fb:["https://www.facebook.com/dialog/oauth?client_id=198760110163592","display=popup","redirect_uri="+t+"fb"].join("&"),gp:["https://accounts.google.com/o/oauth2/auth?client_id=183366446733-u0in3boluil3n9lhqv66g5p63lm52onf.apps.googleusercontent.com","response_type=code","scope=openid","redirect_uri="+t+"gp"].join("&")},n=function(t){if($(this).data("id")&&(t=$(this).data("id")),!i[t])return!1;{var n="status=1,width=600,height=420,location=0,menubar=0,centerscreen=yes",e=window.open(i[t],"OAuth",n);window.location.hostname.split(".")}setInterval(function(){-1!=e.location.hash.indexOf("success")&&(location.reload(),e.close())},400)};return n}();$(function(){var t=function(){$("#main").css({minHeight:$(window).height()-38})};$(window).resize(t),t();var i=function(){Modal.Open(Templates("loginModal"),function(){$(".list .ss a").click(OAuth)},400)};$(".login").click(i)});!function(t){"use strict";function e(t){var e=0,a=0;if(t.offsetParent)do e+=t.offsetLeft,a+=t.offsetTop;while(t=t.offsetParent);return{top:a,left:e}}function a(t){var e="";for(var a in t)t.hasOwnProperty(a)&&(e+=a+":"+t[a]+";");return e}var i=i||{},n=document.querySelectorAll.bind(document),r={duration:500,show:function(t){var i=this,n=document.createElement("div");n.className=n.className+"waves-ripple",i.appendChild(n);var o=e(i),s=t.pageY-o.top,d=t.pageX-o.left,u=1.4*i.clientWidth;n.setAttribute("data-hold",Date.now()),n.setAttribute("data-x",d),n.setAttribute("data-y",s);var l={top:s+"px",left:d+"px"};n.className=n.className+" waves-notransition",n.setAttribute("style",a(l)),n.offsetHeight,n.className=n.className.replace("waves-notransition",""),l["border-width"]=u+"px",l["margin-top"]="-"+u+"px",l["margin-left"]="-"+u+"px",l.opacity="1",l["-webkit-transition-duration"]=r.duration+"ms",l["-moz-transition-duration"]=r.duration+"ms",l["-o-transition-duration"]=r.duration+"ms",l["transition-duration"]=r.duration+"ms",n.setAttribute("style",a(l))},hide:function(){for(var t=this,e=1.4*t.clientWidth,i=null,n=0;n<t.children.length;n++)-1===t.children[n].className.indexOf("waves-ripple")||(i=t.children[n]);if(!i)return!1;var o=i.getAttribute("data-x"),s=i.getAttribute("data-y"),d=Date.now()-Number(i.getAttribute("data-hold")),u=500-d;0>u&&(u=0),setTimeout(function(){var n={top:s+"px",left:o+"px","border-width":e+"px","margin-top":"-"+e+"px","margin-left":"-"+e+"px",opacity:"0","-webkit-transition-duration":r.duration+"ms","-moz-transition-duration":r.duration+"ms","-o-transition-duration":r.duration+"ms","transition-duration":r.duration+"ms"};i.setAttribute("style",a(n)),setTimeout(function(){try{t.removeChild(i)}catch(e){return!1}},300)},u)},wrapInput:function(t){for(var e=0;e<t.length;e++){var a=t[e];if("input"===a.tagName.toLowerCase()){var i=a.parentNode;if("i"===i.tagName.toLowerCase()&&-1!==i.className.indexOf("waves-effect"))return!1;var n=document.createElement("i");n.className=a.className+" waves-input-wrapper";var r=a.getAttribute("style"),o="width:"+a.offsetWidth+"px;height:"+a.clientHeight+"px;";r||(r=""),n.setAttribute("style",o+r),a.className="waves-button-input",a.removeAttribute("style"),i.replaceChild(n,a),n.appendChild(a)}}}};i.displayEffect=function(e){e=e||{},"duration"in e&&(r.duration=e.duration),r.wrapInput(n(".waves-effect")),Array.prototype.forEach.call(n(".waves-effect"),function(e){t.Touch&&(e.addEventListener("touchstart",r.show,!1),e.addEventListener("touchend",r.hide,!1)),e.addEventListener("mousedown",r.show,!1),e.addEventListener("mouseup",r.hide,!1),e.addEventListener("mouseleave",r.hide,!1)})},t.Waves=i}(window);var m=m||!1,imgs=[];m&&m.images&&m.images.length>0&&(imgs=m.images),$(function(){var i=document.querySelectorAll(".pswp")[0],t=function(){var i=function(){var i=$(window).width(),t=20;if($("#p").hasClass("mini"))var a=$("#p").data("W");else{var a=0;$("#p .cascade .pane, #p .right").each(function(){a+=$(this).width()+t}),$("#p").data("W",a)}if(i>=a+t)console.log("Full Panel"),$(".place").html(""),$("#p").removeClass("mini");else{console.log("Small Panel");var e="",n=$(".pgtitle").html();n&&(e+='<h2><a href="/">'+n+"</a></h2>");var o=$(".pmtitle").html();o&&(e+="<h3>"+o+"</h3>"),$(".place").html(e),$("#p").addClass("mini")}FixWidth(".imgs.e","a",i>360?200:120,3)};return i(),$(".imgs.e").css({height:"auto"}),i}(),a=function(){if(0!=imgs.length){var i=!1,t=0,a=6,e=function(){if(!i){var e=$(".imgs.e").width(),n=$(".imgs.e a")[0].style.height,o=Number(n.replace("px",""))+a,s=$(window).height()+window.scrollY,l=Math.round(s/o+1)*Math.round(e/o);i=setInterval(function(){if(console.log(t),t<imgs.length&&l>t){var a=hard+imgs[t].src_xthumb,e='<img src="'+a+'" onload="$(this).fadeIn(250)" />';$('[data-id="'+imgs[t].id+'"]').html(e),t++}else clearInterval(i),i=!1},50)}};return e(),e}}();window.onresize=function(){Stack(t,300),Stack(a,50)},window.onscroll=function(){Stack(a,50)},function(){function t(i){var t=i||0===i?[imgs[i].title]:[];t.push(m.title,m.author,"Мазепа"),$("title").html(t.join(" ∞ "));var a=location.pathname.indexOf("/albums/")?"/":"/albums/";a+=Number(m.id).toString(32)+"/",(i||0===i)&&(a+=imgs[i].id),history.pushState(!1,t.join(" ∞ "),a)}function a(a){var e=$('[data-id="'+a+'"]');if(0==e.length)return t();var o=e.data("i");if(r)return r.goTo(o);var s={index:o};r=new PhotoSwipe(i,PhotoSwipeUI_Default,n,s),r.listen("close",function(){t(),r=!1}),r.listen("afterChange",function(){var i=$('[data-id="'+r.currItem.pid+'"]').data("i");t(i)}),r.init()}function e(){return location.pathname.split("/").slice(3)[0]||""}var n=[];for(var o in imgs){var s=Picture.Src(imgs[o]),l=Picture.Size(s);n.push({src:s,w:l[0],h:l[1],pid:imgs[o].id})}var r=!1,c="";setInterval(function(){var i=e();c!=i&&(c=i,""!=c&&a(i),console.log("> Changed"))},100),$(".imgs.e a").click(function(i){i.preventDefault(),a($(this).data("id"))})}(),function(){var i=!1,t=$(".bookmark");0!=t.length&&(m.bookmark&&(t.addClass("saved")[0].dataset.tooltip="Убрать из закладок"),t.click(function(){if(0==level)return Login();if(!i){if(i=!0,t.hasClass("saved")){var a=0;t.removeClass("saved")[0].dataset.tooltip="Добавить в закладки"}else{var a=1;t.addClass("saved")[0].dataset.tooltip="Убрать из закладок"}Library("Bookmark",{aid:m.id,add:a},function(){i=!1})}}))}()});