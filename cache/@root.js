function ivEncodeEntities(t){return $("<div/>").text(t).html()}function ivDecodeEntities(t){return $("<div/>").html(t).text()}function FixWidth(t,i,n,e){var o=n||80,e=e||0;$(t).each(function(){var t=$(this),n=t.width()-1,r=t.find(i),a=parseInt(n/o)+1;if(a>r.length)return!0;var c=n/a-2*e;r.css({width:c+"px",height:c+"px"}),t.css({minHeight:c*parseInt(r.length/a)-1})}),console.log("Выровнено! =)")}var host="mazepa.us",hard="//hard.mazepa.us",token=token||"",api=api||"/root/library/",Library=function(t,i){var n=!1;return function(e,o,r){return n?void console.log("> Множественные запросы запрещены"):(n=!0,void $.post(i+e,$.extend({token:t},o||{}),function(i){return n=!1,"object"==typeof i?(t=i.token||!1,t||console.log("> Ошибка: token не найден"),void("function"==typeof r&&r(i))):void console.log("> Некорректен формат ответа сервера")},"json"))}}(token,api),Templates=function(t){var i={};return $(t).each(function(){i[$(this).attr("id")]=$(this).remove().html()}),function(t,n){var n=n||{},e=i[t]||"";for(var o in n){var r=new RegExp("{"+o+"}","g");e=e.replace(r,n[o])}return e}}(".template"),Modal=function(){var t=function(){return $(".msg, .black").remove(),!1},i=function(i,n,e){$("body").append('<div class="black"></div><div class="box msg"></div>');var e=parseInt(e||300);100>e&&(e=300),e>$(window).width()-40&&(e=$(window).width()-40),$(".black").click(t).fadeIn(300);var o=$(".msg").append(i||"<h2>Modal</h2>").addClass("animation-jelly");o.css({width:e,marginLeft:-e/2,top:"50%",marginTop:-o.height()/2-15}),(n||function(){})(o)};return{Open:i,Close:t}}(),Picture=function(){var t=function(t){if(!t)return[0,0];var i=t.split(".").slice(-2,-1)[0],n=t.split(".").slice(-3,-2)[0],e=(i.indexOf("x")>=0?i:n).split("x"),o=[e[0]||1,e[1]||1];return o},i=function(i){var n=t(i);return n[0]>$(window).width()||n[1]>$(window).height()},n=function(t){return t.src_small&&i(t.src_small)?hard+t.src_small:t.src_medium&&i(t.src_medium)?hard+t.src_medium:t.src_large&&i(t.src_large)?hard+t.src_large:hard+t.src_main},e=function(i){var e=t(n(i)),o={W:e[0]||1,H:e[1]||1,padding:e[2]||0},r=o.W/o.H,a={W:$(window).width(),H:$(window).height()},c={top:0,left:0,height:o.H,width:o.W},s=r>a.W/(a.H-o.padding);return(1.5*o.W>a.W||1.5*o.H>a.H)&&(s?(c.height=a.W/r,c.width=a.W):(c.width=(a.H-o.padding)*r,c.height=a.H-o.padding)),c.top=(a.H-o.padding-(c.height||o.H))/2,c.left=(a.W-(c.width||o.W))/2,c};return{Src:n,CSS:e,Size:t}}(),Stack=function(){var t={};return function(i,n){if(i){var e=i.toString();t[e]&&clearInterval(t[e].timeout),t[e]={timer:n||500},t[e].timeout=setInterval(function(){return t[e].timer>0?t[e].timer-=50:(clearInterval(t[e].timeout),void i())},50)}}}(),OAuth=function(){var t="https://"+host+"/login/oauth?type=",i={vk:["https://oauth.vk.com/authorize?client_id=4560732","display=popup","scope=friends","redirect_uri="+t+"vk","response_type=code"].join("&"),fb:["https://www.facebook.com/dialog/oauth?client_id=198760110163592","display=popup","redirect_uri="+t+"fb"].join("&"),gp:["https://accounts.google.com/o/oauth2/auth?client_id=183366446733-u0in3boluil3n9lhqv66g5p63lm52onf.apps.googleusercontent.com","response_type=code","scope=openid","redirect_uri="+t+"gp"].join("&")},n=function(t){if($(this).data("id")&&(t=$(this).data("id")),!i[t])return!1;{var n="status=1,width=600,height=420,location=0,menubar=0,centerscreen=yes",e=window.open(i[t],"OAuth",n);window.location.hostname.split(".")}setInterval(function(){-1!=e.location.hash.indexOf("success")&&(location.reload(),e.close())},400)};return n}();$(function(){var t=function(){$("#main").css({minHeight:$(window).height()-38})};$(window).resize(t),t();var i=function(){Modal.Open(Templates("loginModal"),function(){$(".list .ss a").click(OAuth)},400)};$(".login").click(i)});!function(t){"use strict";function e(t){var e=0,a=0;if(t.offsetParent)do e+=t.offsetLeft,a+=t.offsetTop;while(t=t.offsetParent);return{top:a,left:e}}function a(t){var e="";for(var a in t)t.hasOwnProperty(a)&&(e+=a+":"+t[a]+";");return e}var i=i||{},n=document.querySelectorAll.bind(document),r={duration:500,show:function(t){var i=this,n=document.createElement("div");n.className=n.className+"waves-ripple",i.appendChild(n);var o=e(i),s=t.pageY-o.top,d=t.pageX-o.left,u=1.4*i.clientWidth;n.setAttribute("data-hold",Date.now()),n.setAttribute("data-x",d),n.setAttribute("data-y",s);var l={top:s+"px",left:d+"px"};n.className=n.className+" waves-notransition",n.setAttribute("style",a(l)),n.offsetHeight,n.className=n.className.replace("waves-notransition",""),l["border-width"]=u+"px",l["margin-top"]="-"+u+"px",l["margin-left"]="-"+u+"px",l.opacity="1",l["-webkit-transition-duration"]=r.duration+"ms",l["-moz-transition-duration"]=r.duration+"ms",l["-o-transition-duration"]=r.duration+"ms",l["transition-duration"]=r.duration+"ms",n.setAttribute("style",a(l))},hide:function(){for(var t=this,e=1.4*t.clientWidth,i=null,n=0;n<t.children.length;n++)-1===t.children[n].className.indexOf("waves-ripple")||(i=t.children[n]);if(!i)return!1;var o=i.getAttribute("data-x"),s=i.getAttribute("data-y"),d=Date.now()-Number(i.getAttribute("data-hold")),u=500-d;0>u&&(u=0),setTimeout(function(){var n={top:s+"px",left:o+"px","border-width":e+"px","margin-top":"-"+e+"px","margin-left":"-"+e+"px",opacity:"0","-webkit-transition-duration":r.duration+"ms","-moz-transition-duration":r.duration+"ms","-o-transition-duration":r.duration+"ms","transition-duration":r.duration+"ms"};i.setAttribute("style",a(n)),setTimeout(function(){try{t.removeChild(i)}catch(e){return!1}},300)},u)},wrapInput:function(t){for(var e=0;e<t.length;e++){var a=t[e];if("input"===a.tagName.toLowerCase()){var i=a.parentNode;if("i"===i.tagName.toLowerCase()&&-1!==i.className.indexOf("waves-effect"))return!1;var n=document.createElement("i");n.className=a.className+" waves-input-wrapper";var r=a.getAttribute("style"),o="width:"+a.offsetWidth+"px;height:"+a.clientHeight+"px;";r||(r=""),n.setAttribute("style",o+r),a.className="waves-button-input",a.removeAttribute("style"),i.replaceChild(n,a),n.appendChild(a)}}}};i.displayEffect=function(e){e=e||{},"duration"in e&&(r.duration=e.duration),r.wrapInput(n(".waves-effect")),Array.prototype.forEach.call(n(".waves-effect"),function(e){t.Touch&&(e.addEventListener("touchstart",r.show,!1),e.addEventListener("touchend",r.hide,!1)),e.addEventListener("mousedown",r.show,!1),e.addEventListener("mouseup",r.hide,!1),e.addEventListener("mouseleave",r.hide,!1)})},t.Waves=i}(window);!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t,e){var i=0,n=Array.prototype.slice,s=t.cleanData;t.cleanData=function(e){for(var i,n=0;null!=(i=e[n]);n++)try{t(i).triggerHandler("remove")}catch(o){}s(e)},t.widget=function(e,i,n){var s,o,a,r,u={},d=e.split(".")[0];e=e.split(".")[1],s=d+"-"+e,n||(n=i,i=t.Widget),t.expr[":"][s.toLowerCase()]=function(e){return!!t.data(e,s)},t[d]=t[d]||{},o=t[d][e],a=t[d][e]=function(t,e){return this._createWidget?void(arguments.length&&this._createWidget(t,e)):new a(t,e)},t.extend(a,o,{version:n.version,_proto:t.extend({},n),_childConstructors:[]}),r=new i,r.options=t.widget.extend({},r.options),t.each(n,function(e,n){return t.isFunction(n)?void(u[e]=function(){var t=function(){return i.prototype[e].apply(this,arguments)},s=function(t){return i.prototype[e].apply(this,t)};return function(){var e,i=this._super,o=this._superApply;return this._super=t,this._superApply=s,e=n.apply(this,arguments),this._super=i,this._superApply=o,e}}()):void(u[e]=n)}),a.prototype=t.widget.extend(r,{widgetEventPrefix:o?r.widgetEventPrefix:e},u,{constructor:a,namespace:d,widgetName:e,widgetFullName:s}),o?(t.each(o._childConstructors,function(e,i){var n=i.prototype;t.widget(n.namespace+"."+n.widgetName,a,i._proto)}),delete o._childConstructors):i._childConstructors.push(a),t.widget.bridge(e,a)},t.widget.extend=function(i){for(var s,o,a=n.call(arguments,1),r=0,u=a.length;u>r;r++)for(s in a[r])o=a[r][s],a[r].hasOwnProperty(s)&&o!==e&&(i[s]=t.isPlainObject(o)?t.isPlainObject(i[s])?t.widget.extend({},i[s],o):t.widget.extend({},o):o);return i},t.widget.bridge=function(i,s){var o=s.prototype.widgetFullName||i;t.fn[i]=function(a){var r="string"==typeof a,u=n.call(arguments,1),d=this;return a=!r&&u.length?t.widget.extend.apply(null,[a].concat(u)):a,this.each(r?function(){var n,s=t.data(this,o);return s?t.isFunction(s[a])&&"_"!==a.charAt(0)?(n=s[a].apply(s,u),n!==s&&n!==e?(d=n&&n.jquery?d.pushStack(n.get()):n,!1):void 0):t.error("no such method '"+a+"' for "+i+" widget instance"):t.error("cannot call methods on "+i+" prior to initialization; attempted to call method '"+a+"'")}:function(){var e=t.data(this,o);e?e.option(a||{})._init():t.data(this,o,new s(a,this))}),d}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,n){n=t(n||this.defaultElement||this)[0],this.element=t(n),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=t(),this.hoverable=t(),this.focusable=t(),n!==this&&(t.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===n&&this.destroy()}}),this.document=t(n.style?n.ownerDocument:n.document||n),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(i,n){var s,o,a,r=i;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof i)if(r={},s=i.split("."),i=s.shift(),s.length){for(o=r[i]=t.widget.extend({},this.options[i]),a=0;a<s.length-1;a++)o[s[a]]=o[s[a]]||{},o=o[s[a]];if(i=s.pop(),n===e)return o[i]===e?null:o[i];o[i]=n}else{if(n===e)return this.options[i]===e?null:this.options[i];r[i]=n}return this._setOptions(r),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!e).attr("aria-disabled",e),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(e,i,n){var s,o=this;"boolean"!=typeof e&&(n=i,i=e,e=!1),n?(i=s=t(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,s=this.widget()),t.each(n,function(n,a){function r(){return e||o.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof a?o[a]:a).apply(o,arguments):void 0}"string"!=typeof a&&(r.guid=a.guid=a.guid||r.guid||t.guid++);var u=n.match(/^(\w+)\s*(.*)$/),d=u[1]+o.eventNamespace,h=u[2];h?s.delegate(h,d,r):i.bind(d,r)})},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(e).undelegate(e)},_delay:function(t,e){function i(){return("string"==typeof t?n[t]:t).apply(n,arguments)}var n=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,i,n){var s,o,a=this.options[e];if(n=n||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(s in o)s in i||(i[s]=o[s]);return this.element.trigger(i,n),!(t.isFunction(a)&&a.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(n,s,o){"string"==typeof s&&(s={effect:s});var a,r=s?s===!0||"number"==typeof s?i:s.effect||i:e;s=s||{},"number"==typeof s&&(s={duration:s}),a=!t.isEmptyObject(s),s.complete=o,s.delay&&n.delay(s.delay),a&&t.effects&&t.effects.effect[r]?n[e](s):r!==e&&n[r]?n[r](s.duration,s.easing,o):n.queue(function(i){t(this)[e](),o&&o.call(n[0]),i()})}})});!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery)}(function(e){"use strict";var t=0;e.ajaxTransport("iframe",function(r){if(r.async){var a,n,o;return{send:function(p,i){a=e('<form style="display:none;"></form>'),a.attr("accept-charset",r.formAcceptCharset),o=/\?/.test(r.url)?"&":"?","DELETE"===r.type?(r.url=r.url+o+"_method=DELETE",r.type="POST"):"PUT"===r.type?(r.url=r.url+o+"_method=PUT",r.type="POST"):"PATCH"===r.type&&(r.url=r.url+o+"_method=PATCH",r.type="POST"),n=e('<iframe src="javascript:false;" name="iframe-transport-'+(t+=1)+'"></iframe>').bind("load",function(){var t,o=e.isArray(r.paramName)?r.paramName:[r.paramName];n.unbind("load").bind("load",function(){var t;try{if(t=n.contents(),!t.length||!t[0].firstChild)throw new Error}catch(r){t=void 0}i(200,"success",{iframe:t}),e('<iframe src="javascript:false;"></iframe>').appendTo(a),a.remove()}),a.prop("target",n.prop("name")).prop("action",r.url).prop("method",r.type),r.formData&&e.each(r.formData,function(t,r){e('<input type="hidden"/>').prop("name",r.name).val(r.value).appendTo(a)}),r.fileInput&&r.fileInput.length&&"POST"===r.type&&(t=r.fileInput.clone(),r.fileInput.after(function(e){return t[e]}),r.paramName&&r.fileInput.each(function(t){e(this).prop("name",o[t]||r.paramName)}),a.append(r.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data")),a.submit(),t&&t.length&&r.fileInput.each(function(r,a){var n=e(t[r]);e(a).prop("name",n.prop("name")),n.replaceWith(a)})}),a.append(n).appendTo(document.body)},abort:function(){n&&n.unbind("load").prop("src","javascript".concat(":false;")),a&&a.remove()}}}}),e.ajaxSetup({converters:{"iframe text":function(t){return t&&e(t[0].body).text()},"iframe json":function(t){return t&&e.parseJSON(e(t[0].body).text())},"iframe html":function(t){return t&&e(t[0].body).html()},"iframe script":function(t){return t&&e.globalEval(e(t[0].body).text())}}})});!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],e):e(window.jQuery)}(function(e){"use strict";e.support.xhrFileUpload=!(!window.XMLHttpRequestUpload||!window.FileReader),e.support.xhrFormDataFileUpload=!!window.FormData,e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:e(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,formData:function(e){return e.serializeArray()},add:function(t,i){(i.autoUpload||i.autoUpload!==!1&&(e(this).data("blueimp-fileupload")||e(this).data("fileupload")).options.autoUpload)&&i.submit()},processData:!1,contentType:!1,cache:!1},_refreshOptionsList:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_BitrateTimer:function(){this.timestamp=+new Date,this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,i){var r=e-this.timestamp;return(!this.bitrate||!i||r>i)&&(this.bitrate=(t-this.loaded)*(1e3/r)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var i;return"function"==typeof t.formData?t.formData(t.form):e.isArray(t.formData)?t.formData:t.formData?(i=[],e.each(t.formData,function(e,t){i.push({name:e,value:t})}),i):[]},_getTotal:function(t){var i=0;return e.each(t,function(e,t){i+=t.size||1}),i},_initProgressObject:function(e){e._progress={loaded:0,total:0,bitrate:0}},_onProgress:function(e,t){if(e.lengthComputable){var i,r=+new Date;if(t._time&&t.progressInterval&&r-t._time<t.progressInterval&&e.loaded!==e.total)return;t._time=r,i=Math.floor(e.loaded/e.total*(t.chunkSize||t._progress.total))+(t.uploadedBytes||0),this._progress.loaded+=i-t._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(r,this._progress.loaded,t.bitrateInterval),t._progress.loaded=t.loaded=i,t._progress.bitrate=t.bitrate=t._bitrateTimer.getBitrate(r,i,t.bitrateInterval),this._trigger("progress",e,t),this._trigger("progressall",e,this._progress)}},_initProgressListener:function(t){var i=this,r=t.xhr?t.xhr():e.ajaxSettings.xhr();r.upload&&(e(r.upload).bind("progress",function(e){var r=e.originalEvent;e.lengthComputable=r.lengthComputable,e.loaded=r.loaded,e.total=r.total,i._onProgress(e,t)}),t.xhr=function(){return r})},_initXHRData:function(t){var i,r=t.files[0],n=t.multipart||!e.support.xhrFileUpload,o=t.paramName[0];t.headers=t.headers||{},t.contentRange&&(t.headers["Content-Range"]=t.contentRange),n?e.support.xhrFormDataFileUpload&&(t.postMessage?(i=this._getFormData(t),t.blob?i.push({name:o,value:t.blob}):e.each(t.files,function(e,r){i.push({name:t.paramName[e]||o,value:r})})):(t.formData instanceof FormData?i=t.formData:(i=new FormData,e.each(this._getFormData(t),function(e,t){i.append(t.name,t.value)})),t.blob?(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(r.name)+'"',i.append(o,t.blob,r.name)):e.each(t.files,function(e,r){(window.Blob&&r instanceof Blob||window.File&&r instanceof File)&&i.append(t.paramName[e]||o,r,r.name)})),t.data=i):(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(r.name)+'"',t.contentType=r.type,t.data=t.blob||r),t.blob=null},_initIframeSettings:function(t){t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&e("<a></a>").prop("href",t.url).prop("host")!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e,"iframe")},_getParamName:function(t){var i=e(t.fileInput),r=t.paramName;return r?e.isArray(r)||(r=[r]):(r=[],i.each(function(){for(var t=e(this),i=t.prop("name")||"files[]",n=(t.prop("files")||[1]).length;n;)r.push(i),n-=1}),r.length||(r=[i.prop("name")||"files[]"])),r},_initFormSettings:function(t){t.form&&t.form.length||(t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")))),t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||t.form.prop("method")||"").toUpperCase(),"POST"!==t.type&&"PUT"!==t.type&&"PATCH"!==t.type&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var i=e.extend({},this.options,t);return this._initFormSettings(i),this._initDataSettings(i),i},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,i,r){var n=e.Deferred(),o=n.promise();return i=i||this.options.context||o,t===!0?n.resolveWith(i,r):t===!1&&n.rejectWith(i,r),o.abort=n.promise,this._enhancePromise(o)},_addConvenienceMethods:function(e,t){var i=this;t.submit=function(){return"pending"!==this.state()&&(t.jqXHR=this.jqXHR=i._trigger("submit",e,this)!==!1&&i._onSend(e,this)),this.jqXHR||i._getXHRPromise()},t.abort=function(){return this.jqXHR?this.jqXHR.abort():this._getXHRPromise()},t.state=function(){return this.jqXHR?i._getDeferredState(this.jqXHR):void 0},t.progress=function(){return this._progress}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),i=t&&t.split("-"),r=i&&i.length>1&&parseInt(i[1],10);return r&&r+1},_chunkedUpload:function(t,i){var r,n,o=this,s=t.files[0],a=s.size,l=t.uploadedBytes=t.uploadedBytes||0,p=t.maxChunkSize||a,d=s.slice||s.webkitSlice||s.mozSlice,u=e.Deferred(),h=u.promise();return this._isXHRUpload(t)&&d&&(l||a>p)&&!t.data?i?!0:l>=a?(s.error="Uploaded bytes exceed file size",this._getXHRPromise(!1,t.context,[null,"error",s.error])):(n=function(){var i=e.extend({},t),h=i._progress.loaded;i.blob=d.call(s,l,l+p,s.type),i.chunkSize=i.blob.size,i.contentRange="bytes "+l+"-"+(l+i.chunkSize-1)+"/"+a,o._initXHRData(i),o._initProgressListener(i),r=(o._trigger("chunksend",null,i)!==!1&&e.ajax(i)||o._getXHRPromise(!1,i.context)).done(function(r,s,p){l=o._getUploadedBytes(p)||l+i.chunkSize,i._progress.loaded===h&&o._onProgress(e.Event("progress",{lengthComputable:!0,loaded:l-i.uploadedBytes,total:l-i.uploadedBytes}),i),t.uploadedBytes=i.uploadedBytes=l,i.result=r,i.textStatus=s,i.jqXHR=p,o._trigger("chunkdone",null,i),o._trigger("chunkalways",null,i),a>l?n():u.resolveWith(i.context,[r,s,p])}).fail(function(e,t,r){i.jqXHR=e,i.textStatus=t,i.errorThrown=r,o._trigger("chunkfail",null,i),o._trigger("chunkalways",null,i),u.rejectWith(i.context,[e,t,r])})},this._enhancePromise(h),h.abort=function(){return r.abort()},n(),h):!1},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),t._progress||(t._progress={}),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(t,i,r,n){var o=n._progress.total;n._progress.loaded<o&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:o,total:o}),n),n.result=t,n.textStatus=i,n.jqXHR=r,this._trigger("done",null,n)},_onFail:function(e,t,i,r){r.jqXHR=e,r.textStatus=t,r.errorThrown=i,this._trigger("fail",null,r),r.recalculateProgress&&(this._progress.loaded-=r._progress.loaded,this._progress.total-=r._progress.total)},_onAlways:function(e,t,i,r){this._active-=1,this._trigger("always",null,r),0===this._active&&this._trigger("stop")},_onSend:function(t,i){i.submit||this._addConvenienceMethods(t,i);var r,n,o,s,a=this,l=a._getAJAXSettings(i),p=function(){return a._sending+=1,l._bitrateTimer=new a._BitrateTimer,r=r||((n||a._trigger("send",t,l)===!1)&&a._getXHRPromise(!1,l.context,n)||a._chunkedUpload(l)||e.ajax(l)).done(function(e,t,i){a._onDone(e,t,i,l)}).fail(function(e,t,i){a._onFail(e,t,i,l)}).always(function(e,t,i){if(a._sending-=1,a._onAlways(e,t,i,l),l.limitConcurrentUploads&&l.limitConcurrentUploads>a._sending)for(var r=a._slots.shift();r;){if("pending"===a._getDeferredState(r)){r.resolve();break}r=a._slots.shift()}})};return this._beforeSend(t,l),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(o=e.Deferred(),this._slots.push(o),s=o.pipe(p)):s=this._sequence=this._sequence.pipe(p,p),s.abort=function(){return n=[void 0,"abort","abort"],r?r.abort():(o&&o.rejectWith(l.context,n),p())},this._enhancePromise(s)):p()},_onAdd:function(t,i){var r,n,o,s,a=this,l=!0,p=e.extend({},this.options,i),d=p.limitMultiFileUploads,u=this._getParamName(p);if((p.singleFileUploads||d)&&this._isXHRUpload(p))if(!p.singleFileUploads&&d)for(o=[],r=[],s=0;s<i.files.length;s+=d)o.push(i.files.slice(s,s+d)),n=u.slice(s,s+d),n.length||(n=u),r.push(n);else r=u;else o=[i.files],r=[u];return i.originalFiles=i.files,e.each(o||i.files,function(n,s){var p=e.extend({},i);return p.files=o?s:[s],p.paramName=r[n],a._initProgressObject(p),a._addConvenienceMethods(t,p),l=a._trigger("add",t,p)}),l},_replaceFileInput:function(t){var i=t.clone(!0);e("<form></form>").append(i)[0].reset(),t.after(i).detach(),e.cleanData(t.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,r){return r===t[0]?i[0]:r}),t[0]===this.element[0]&&(this.element=i)},_handleFileTreeEntry:function(t,i){var r,n=this,o=e.Deferred(),s=function(e){e&&!e.entry&&(e.entry=t),o.resolve([e])};return i=i||"",t.isFile?t._file?(t._file.relativePath=i,o.resolve(t._file)):t.file(function(e){e.relativePath=i,o.resolve(e)},s):t.isDirectory?(r=t.createReader(),r.readEntries(function(e){n._handleFileTreeEntries(e,i+t.name+"/").done(function(e){o.resolve(e)}).fail(s)},s)):o.resolve([]),o.promise()},_handleFileTreeEntries:function(t,i){var r=this;return e.when.apply(e,e.map(t,function(e){return r._handleFileTreeEntry(e,i)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var i=t.items;return i&&i.length&&(i[0].webkitGetAsEntry||i[0].getAsEntry)?this._handleFileTreeEntries(e.map(i,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var i,r,n=t.prop("webkitEntries")||t.prop("entries");if(n&&n.length)return this._handleFileTreeEntries(n);if(i=e.makeArray(t.prop("files")),i.length)void 0===i[0].name&&i[0].fileName&&e.each(i,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(r=t.prop("value"),!r)return e.Deferred().resolve([]).promise();i=[{name:r.replace(/^.*\\/,"")}]}return e.Deferred().resolve(i).promise()},_getFileInputFiles:function(t){return t instanceof e&&1!==t.length?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var i=this,r={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(r.fileInput).always(function(e){r.files=e,i.options.replaceFileInput&&i._replaceFileInput(r.fileInput),i._trigger("change",t,r)!==!1&&i._onAdd(t,r)})},_onPaste:function(t){var i=t.originalEvent.clipboardData,r=i&&i.items||[],n={files:[]};return e.each(r,function(e,t){var i=t.getAsFile&&t.getAsFile();i&&n.files.push(i)}),this._trigger("paste",t,n)===!1||this._onAdd(t,n)===!1?!1:void 0},_onDrop:function(e){var t=this,i=e.dataTransfer=e.originalEvent.dataTransfer,r={};i&&i.files&&i.files.length&&e.preventDefault(),this._getDroppedFiles(i).always(function(i){r.files=i,t._trigger("drop",e,r)!==!1&&t._onAdd(e,r)})},_onDragOver:function(t){var i=t.dataTransfer=t.originalEvent.dataTransfer;return this._trigger("dragover",t)===!1?!1:void(i&&-1!==e.inArray("Files",i.types)&&(i.dropEffect="copy",t.preventDefault()))},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste})),this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(t,i){var r=-1!==e.inArray(t,this._refreshOptionsList);r&&this._destroyEventHandlers(),this._super(t,i),r&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;void 0===t.fileInput?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_create:function(){var t=this.options;e.extend(t,e(this.element[0].cloneNode(!1)).data()),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},progress:function(){return this._progress},add:function(t){var i=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,i._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var i,r,n=this,o=e.Deferred(),s=o.promise();return s.abort=function(){return r=!0,i?i.abort():(o.reject(null,"abort","abort"),s)},this._getFileInputFiles(t.fileInput).always(function(e){r||(t.files=e,i=n._onSend(null,t).then(function(e,t,i){o.resolve(e,t,i)},function(e,t,i){o.reject(e,t,i)}))}),this._enhancePromise(s)}if(t.files=e.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})});!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){function e(e,s){var o,n,r,a=e.nodeName.toLowerCase();return"area"===a?(o=e.parentNode,n=o.name,e.href&&n&&"map"===o.nodeName.toLowerCase()?(r=t("img[usemap='#"+n+"']")[0],!!r&&i(r)):!1):(/input|select|textarea|button|object/.test(a)?!e.disabled:"a"===a?e.href||s:s)&&i(e)}function i(e){return t.expr.filters.visible(e)&&!t(e).parents().addBack().filter(function(){return"hidden"===t.css(this,"visibility")}).length}t.ui=t.ui||{},t.extend(t.ui,{version:"1.11.1",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),t.fn.extend({scrollParent:function(e){var i=this.css("position"),s="absolute"===i,o=e?/(auto|scroll|hidden)/:/(auto|scroll)/,n=this.parents().filter(function(){var e=t(this);return s&&"static"===e.css("position")?!1:o.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&n.length?n:t(this[0].ownerDocument||document)},uniqueId:function(){var t=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++t)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")})}}),t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,s){return!!t.data(e,s[3])},focusable:function(i){return e(i,!isNaN(t.attr(i,"tabindex")))},tabbable:function(i){var s=t.attr(i,"tabindex"),o=isNaN(s);return(o||s>=0)&&e(i,!o)}}),t("<a>").outerWidth(1).jquery||t.each(["Width","Height"],function(e,i){function s(e,i,s,n){return t.each(o,function(){i-=parseFloat(t.css(e,"padding"+this))||0,s&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),n&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var o="Width"===i?["Left","Right"]:["Top","Bottom"],n=i.toLowerCase(),r={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(e){return void 0===e?r["inner"+i].call(this):this.each(function(){t(this).css(n,s(this,e)+"px")})},t.fn["outer"+i]=function(e,o){return"number"!=typeof e?r["outer"+i].call(this,e):this.each(function(){t(this).css(n,s(this,e,!0,o)+"px")})}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(t.fn.removeData=function(e){return function(i){return arguments.length?e.call(this,t.camelCase(i)):e.call(this)}}(t.fn.removeData)),t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),t.fn.extend({focus:function(e){return function(i,s){return"number"==typeof i?this.each(function(){var e=this;setTimeout(function(){t(e).focus(),s&&s.call(e)},i)}):e.apply(this,arguments)}}(t.fn.focus),disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(e){if(void 0!==e)return this.css("zIndex",e);if(this.length)for(var i,s,o=t(this[0]);o.length&&o[0]!==document;){if(i=o.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(s=parseInt(o.css("zIndex"),10),!isNaN(s)&&0!==s))return s;o=o.parent()}return 0}}),t.ui.plugin={add:function(e,i,s){var o,n=t.ui[e].prototype;for(o in s)n.plugins[o]=n.plugins[o]||[],n.plugins[o].push([i,s[o]])},call:function(t,e,i,s){var o,n=t.plugins[e];if(n&&(s||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(o=0;n.length>o;o++)t.options[n[o][0]]&&n[o][1].apply(t.element,i)}};var s=0,o=Array.prototype.slice;t.cleanData=function(e){return function(i){var s,o,n;for(n=0;null!=(o=i[n]);n++)try{s=t._data(o,"events"),s&&s.remove&&t(o).triggerHandler("remove")}catch(r){}e(i)}}(t.cleanData),t.widget=function(e,i,s){var o,n,r,a,h={},l=e.split(".")[0];return e=e.split(".")[1],o=l+"-"+e,s||(s=i,i=t.Widget),t.expr[":"][o.toLowerCase()]=function(e){return!!t.data(e,o)},t[l]=t[l]||{},n=t[l][e],r=t[l][e]=function(t,e){return this._createWidget?void(arguments.length&&this._createWidget(t,e)):new r(t,e)},t.extend(r,n,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),a=new i,a.options=t.widget.extend({},a.options),t.each(s,function(e,s){return t.isFunction(s)?void(h[e]=function(){var t=function(){return i.prototype[e].apply(this,arguments)},o=function(t){return i.prototype[e].apply(this,t)};return function(){var e,i=this._super,n=this._superApply;return this._super=t,this._superApply=o,e=s.apply(this,arguments),this._super=i,this._superApply=n,e}}()):void(h[e]=s)}),r.prototype=t.widget.extend(a,{widgetEventPrefix:n?a.widgetEventPrefix||e:e},h,{constructor:r,namespace:l,widgetName:e,widgetFullName:o}),n?(t.each(n._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,r,i._proto)}),delete n._childConstructors):i._childConstructors.push(r),t.widget.bridge(e,r),r},t.widget.extend=function(e){for(var i,s,n=o.call(arguments,1),r=0,a=n.length;a>r;r++)for(i in n[r])s=n[r][i],n[r].hasOwnProperty(i)&&void 0!==s&&(e[i]=t.isPlainObject(s)?t.isPlainObject(e[i])?t.widget.extend({},e[i],s):t.widget.extend({},s):s);return e},t.widget.bridge=function(e,i){var s=i.prototype.widgetFullName||e;t.fn[e]=function(n){var r="string"==typeof n,a=o.call(arguments,1),h=this;return n=!r&&a.length?t.widget.extend.apply(null,[n].concat(a)):n,this.each(r?function(){var i,o=t.data(this,s);return"instance"===n?(h=o,!1):o?t.isFunction(o[n])&&"_"!==n.charAt(0)?(i=o[n].apply(o,a),i!==o&&void 0!==i?(h=i&&i.jquery?h.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+n+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+n+"'")}:function(){var e=t.data(this,s);e?(e.option(n||{}),e._init&&e._init()):t.data(this,s,new i(n,this))}),h}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=s++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=t(),this.hoverable=t(),this.focusable=t(),i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var s,o,n,r=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(r={},s=e.split("."),e=s.shift(),s.length){for(o=r[e]=t.widget.extend({},this.options[e]),n=0;s.length-1>n;n++)o[s[n]]=o[s[n]]||{},o=o[s[n]];if(e=s.pop(),1===arguments.length)return void 0===o[e]?null:o[e];o[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];r[e]=i}return this._setOptions(r),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!e),e&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(e,i,s){var o,n=this;"boolean"!=typeof e&&(s=i,i=e,e=!1),s?(i=o=t(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,o=this.widget()),t.each(s,function(s,r){function a(){return e||n.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof r?n[r]:r).apply(n,arguments):void 0}"string"!=typeof r&&(a.guid=r.guid=r.guid||a.guid||t.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+n.eventNamespace,c=h[2];c?o.delegate(c,l,a):i.bind(l,a)})},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(e).undelegate(e)},_delay:function(t,e){function i(){return("string"==typeof t?s[t]:t).apply(s,arguments)}var s=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,i,s){var o,n,r=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],n=i.originalEvent)for(o in n)o in i||(i[o]=n[o]);return this.element.trigger(i,s),!(t.isFunction(r)&&r.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,o,n){"string"==typeof o&&(o={effect:o});var r,a=o?o===!0||"number"==typeof o?i:o.effect||i:e;o=o||{},"number"==typeof o&&(o={duration:o}),r=!t.isEmptyObject(o),o.complete=n,o.delay&&s.delay(o.delay),r&&t.effects&&t.effects.effect[a]?s[e](o):a!==e&&s[a]?s[a](o.duration,o.easing,n):s.queue(function(i){t(this)[e](),n&&n.call(s[0]),i()})}}),t.widget;var n=!1;t(document).mouseup(function(){n=!1}),t.widget("ui.mouse",{version:"1.11.1",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!n){this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,s=1===e.which,o="string"==typeof this.options.cancel&&e.target.nodeName?t(e.target).closest(this.options.cancel).length:!1;return s&&!o&&this._mouseCapture(e)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),n=!0,!0)):!0}},_mouseMove:function(e){return t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button?this._mouseUp(e):e.which?this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted):this._mouseUp(e)},_mouseUp:function(e){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),n=!1,!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),t.widget("ui.draggable",t.ui.mouse,{version:"1.11.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?void(this.destroyOnClear=!0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),void this._mouseDestroy())},_mouseCapture:function(e){var i=this.document[0],s=this.options;try{i.activeElement&&"body"!==i.activeElement.nodeName.toLowerCase()&&t(i.activeElement).blur()}catch(o){}return this.helper||s.disabled||t(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(t(s.iframeFix===!0?"iframe":s.iframeFix).each(function(){t("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(t(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_mouseDrag:function(e,i){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",e,s)===!1)return this._mouseUp({}),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,s=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(s=t.ui.ddmanager.drop(this,e)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1},_mouseUp:function(e){return t("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.element.focus(),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){return this.options.handle?!!t(e.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return s.parents("body").length||s.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s[0]===this.element[0]||/(fixed|absolute)/.test(s.css("position"))||s.css("position","absolute"),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(t){return/(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,o=this.options,n=this.document[0];return this.relativeContainer=null,o.containment?"window"===o.containment?void(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||n.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===o.containment?void(this.containment=[0,0,t(n).width()-this.helperProportions.width-this.margins.left,(t(n).height()||n.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):o.containment.constructor===Array?void(this.containment=o.containment):("parent"===o.containment&&(o.containment=this.helper[0].parentNode),i=t(o.containment),s=i[0],void(s&&(e="hidden"!==i.css("overflow"),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i))):void(this.containment=null)},_convertPositionTo:function(t,e){e||(e=this.position);var i="absolute"===t?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:e.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(t,e){var i,s,o,n,r=this.options,a=this._isRootNode(this.scrollParent[0]),h=t.pageX,l=t.pageY;return a&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),r.grid&&(o=r.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/r.grid[1])*r.grid[1]:this.originalPageY,l=i?o-this.offset.click.top>=i[1]||o-this.offset.click.top>i[3]?o:o-this.offset.click.top>=i[1]?o-r.grid[1]:o+r.grid[1]:o,n=r.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/r.grid[0])*r.grid[0]:this.originalPageX,h=i?n-this.offset.click.left>=i[0]||n-this.offset.click.left>i[2]?n:n-this.offset.click.left>=i[0]?n-r.grid[0]:n+r.grid[0]:n),"y"===r.axis&&(h=this.originalPageX),"x"===r.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:a?0:this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:a?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(e,i,s){return s=s||this._uiHash(),t.ui.plugin.call(this,e,[i,s,this],!0),"drag"===e&&(this.positionAbs=this._convertPositionTo("absolute")),t.Widget.prototype._trigger.call(this,e,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i,s){var o=s.options,n=t.extend({},i,{item:s.element});s.sortables=[],t(o.connectToSortable).each(function(){var i=t(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",e,n))})},stop:function(e,i,s){var o=t.extend({},i,{item:s.element});t.each(s.sortables,function(){this.instance.isOver?(this.instance.isOver=0,s.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(e),this.instance.options.helper=this.instance.options._helper,"original"===s.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",e,o))})},drag:function(e,i,s){var o=this;t.each(s.sortables,function(){var n=!1,r=this;this.instance.positionAbs=s.positionAbs,this.instance.helperProportions=s.helperProportions,this.instance.offset.click=s.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(n=!0,t.each(s.sortables,function(){return this.instance.positionAbs=s.positionAbs,this.instance.helperProportions=s.helperProportions,this.instance.offset.click=s.offset.click,this!==r&&this.instance._intersectsWith(this.instance.containerCache)&&t.contains(r.instance.element[0],this.instance.element[0])&&(n=!1),n})),n?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=t(o).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},e.target=this.instance.currentItem[0],this.instance._mouseCapture(e,!0),this.instance._mouseStart(e,!0,!0),this.instance.offset.click.top=s.offset.click.top,this.instance.offset.click.left=s.offset.click.left,this.instance.offset.parent.left-=s.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=s.offset.parent.top-this.instance.offset.parent.top,s._trigger("toSortable",e),s.dropped=this.instance.element,s.currentItem=s.element,this.instance.fromOutside=s),this.instance.currentItem&&this.instance._mouseDrag(e)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",e,this.instance._uiHash(this.instance)),this.instance._mouseStop(e,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),s._trigger("fromSortable",e),s.dropped=!1)})}}),t.ui.plugin.add("draggable","cursor",{start:function(e,i,s){var o=t("body"),n=s.options;o.css("cursor")&&(n._cursor=o.css("cursor")),o.css("cursor",n.cursor)},stop:function(e,i,s){var o=s.options;o._cursor&&t("body").css("cursor",o._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i,s){var o=t(i.helper),n=s.options;o.css("opacity")&&(n._opacity=o.css("opacity")),o.css("opacity",n.opacity)},stop:function(e,i,s){var o=s.options;o._opacity&&t(i.helper).css("opacity",o._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(t,e,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(e,i,s){var o=s.options,n=!1,r=s.scrollParentNotHidden[0],a=s.document[0];r!==a&&"HTML"!==r.tagName?(o.axis&&"x"===o.axis||(s.overflowOffset.top+r.offsetHeight-e.pageY<o.scrollSensitivity?r.scrollTop=n=r.scrollTop+o.scrollSpeed:e.pageY-s.overflowOffset.top<o.scrollSensitivity&&(r.scrollTop=n=r.scrollTop-o.scrollSpeed)),o.axis&&"y"===o.axis||(s.overflowOffset.left+r.offsetWidth-e.pageX<o.scrollSensitivity?r.scrollLeft=n=r.scrollLeft+o.scrollSpeed:e.pageX-s.overflowOffset.left<o.scrollSensitivity&&(r.scrollLeft=n=r.scrollLeft-o.scrollSpeed))):(o.axis&&"x"===o.axis||(e.pageY-t(a).scrollTop()<o.scrollSensitivity?n=t(a).scrollTop(t(a).scrollTop()-o.scrollSpeed):t(window).height()-(e.pageY-t(a).scrollTop())<o.scrollSensitivity&&(n=t(a).scrollTop(t(a).scrollTop()+o.scrollSpeed))),o.axis&&"y"===o.axis||(e.pageX-t(a).scrollLeft()<o.scrollSensitivity?n=t(a).scrollLeft(t(a).scrollLeft()-o.scrollSpeed):t(window).width()-(e.pageX-t(a).scrollLeft())<o.scrollSensitivity&&(n=t(a).scrollLeft(t(a).scrollLeft()+o.scrollSpeed)))),n!==!1&&t.ui.ddmanager&&!o.dropBehaviour&&t.ui.ddmanager.prepareOffsets(s,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,i,s){var o=s.options;s.snapElements=[],t(o.snap.constructor!==String?o.snap.items||":data(ui-draggable)":o.snap).each(function(){var e=t(this),i=e.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})})},drag:function(e,i,s){var o,n,r,a,h,l,c,p,u,f,d=s.options,m=d.snapTolerance,g=i.offset.left,v=g+s.helperProportions.width,_=i.offset.top,b=_+s.helperProportions.height;for(u=s.snapElements.length-1;u>=0;u--)h=s.snapElements[u].left,l=h+s.snapElements[u].width,c=s.snapElements[u].top,p=c+s.snapElements[u].height,h-m>v||g>l+m||c-m>b||_>p+m||!t.contains(s.snapElements[u].item.ownerDocument,s.snapElements[u].item)?(s.snapElements[u].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[u].item})),s.snapElements[u].snapping=!1):("inner"!==d.snapMode&&(o=m>=Math.abs(c-b),n=m>=Math.abs(p-_),r=m>=Math.abs(h-v),a=m>=Math.abs(l-g),o&&(i.position.top=s._convertPositionTo("relative",{top:c-s.helperProportions.height,left:0}).top-s.margins.top),n&&(i.position.top=s._convertPositionTo("relative",{top:p,left:0}).top-s.margins.top),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left-s.margins.left),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left-s.margins.left)),f=o||n||r||a,"outer"!==d.snapMode&&(o=m>=Math.abs(c-_),n=m>=Math.abs(p-b),r=m>=Math.abs(h-g),a=m>=Math.abs(l-v),o&&(i.position.top=s._convertPositionTo("relative",{top:c,left:0}).top-s.margins.top),n&&(i.position.top=s._convertPositionTo("relative",{top:p-s.helperProportions.height,left:0}).top-s.margins.top),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left-s.margins.left),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left-s.margins.left)),!s.snapElements[u].snapping&&(o||n||r||a||f)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[u].item})),s.snapElements[u].snapping=o||n||r||a||f)}}),t.ui.plugin.add("draggable","stack",{start:function(e,i,s){var o,n=s.options,r=t.makeArray(t(n.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});r.length&&(o=parseInt(t(r[0]).css("zIndex"),10)||0,t(r).each(function(e){t(this).css("zIndex",o+e)}),this.css("zIndex",o+r.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i,s){var o=t(i.helper),n=s.options;o.css("zIndex")&&(n._zIndex=o.css("zIndex")),o.css("zIndex",n.zIndex)},stop:function(e,i,s){var o=s.options;o._zIndex&&t(i.helper).css("zIndex",o._zIndex)}}),t.ui.draggable,t.widget("ui.droppable",{version:"1.11.1",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(s)?s:function(t){return t.is(s)},this.proportions=function(){return arguments.length?void(e=arguments[0]):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(e){t.ui.ddmanager.droppables[e]=t.ui.ddmanager.droppables[e]||[],t.ui.ddmanager.droppables[e].push(this)},_splice:function(t){for(var e=0;t.length>e;e++)t[e]===this&&t.splice(e,1)},_destroy:function(){var e=t.ui.ddmanager.droppables[this.options.scope];this._splice(e),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(e,i){if("accept"===e)this.accept=t.isFunction(i)?i:function(t){return t.is(i)};else if("scope"===e){var s=t.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(e,i)},_activate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var s=i||t.ui.ddmanager.current,o=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=t(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&t.ui.intersect(s,t.extend(i,{offset:i.element.offset()}),i.options.tolerance,e)?(o=!0,!1):void 0}),o?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",e,this.ui(s)),this.element):!1):!1},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}}}),t.ui.intersect=function(){function t(t,e,i){return t>=e&&e+i>t}return function(e,i,s,o){if(!i.offset)return!1;var n=(e.positionAbs||e.position.absolute).left,r=(e.positionAbs||e.position.absolute).top,a=n+e.helperProportions.width,h=r+e.helperProportions.height,l=i.offset.left,c=i.offset.top,p=l+i.proportions().width,u=c+i.proportions().height;switch(s){case"fit":return n>=l&&p>=a&&r>=c&&u>=h;case"intersect":return n+e.helperProportions.width/2>l&&p>a-e.helperProportions.width/2&&r+e.helperProportions.height/2>c&&u>h-e.helperProportions.height/2;case"pointer":return t(o.pageY,c,i.proportions().height)&&t(o.pageX,l,i.proportions().width);case"touch":return(r>=c&&u>=r||h>=c&&u>=h||c>r&&h>u)&&(n>=l&&p>=n||a>=l&&p>=a||l>n&&a>p);default:return!1}}}(),t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,i){var s,o,n=t.ui.ddmanager.droppables[e.options.scope]||[],r=i?i.type:null,a=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(s=0;n.length>s;s++)if(!(n[s].options.disabled||e&&!n[s].accept.call(n[s].element[0],e.currentItem||e.element))){for(o=0;a.length>o;o++)if(a[o]===n[s].element[0]){n[s].proportions().height=0;continue t}n[s].visible="none"!==n[s].element.css("display"),n[s].visible&&("mousedown"===r&&n[s]._activate.call(n[s],i),n[s].offset=n[s].element.offset(),n[s].proportions({width:n[s].element[0].offsetWidth,height:n[s].element[0].offsetHeight}))}},drop:function(e,i){var s=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&t.ui.intersect(e,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(e,i){e.element.parentsUntil("body").bind("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,o,n,r=t.ui.intersect(e,this,this.options.tolerance,i),a=!r&&this.isover?"isout":r&&!this.isover?"isover":null;a&&(this.options.greedy&&(o=this.options.scope,n=this.element.parents(":data(ui-droppable)").filter(function(){return t(this).droppable("instance").options.scope===o}),n.length&&(s=t(n[0]).droppable("instance"),s.greedyChild="isover"===a)),s&&"isover"===a&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[a]=!0,this["isout"===a?"isover":"isout"]=!1,this["isover"===a?"_over":"_out"].call(this,i),s&&"isout"===a&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(e,i){e.element.parentsUntil("body").unbind("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}},t.ui.droppable,t.widget("ui.sortable",t.ui.mouse,{version:"1.11.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return t>=e&&e+i>t},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){var t=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===t.axis||this._isFloating(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),t.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,i){var s=null,o=!1,n=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,n.widgetName+"-item")===n?(s=t(this),!1):void 0}),t.data(e.target,n.widgetName+"-item")===n&&(s=t(e.target)),s&&(!this.options.handle||i||(t(this.options.handle,s).find("*").addBack().each(function(){this===e.target&&(o=!0)}),o))?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1)},_mouseStart:function(e,i,s){var o,n,r=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,r.cursorAt&&this._adjustOffsetFromHelper(r.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),r.containment&&this._setContainment(),r.cursor&&"auto"!==r.cursor&&(n=this.document.find("body"),this.storedCursor=n.css("cursor"),n.css("cursor",r.cursor),this.storedStylesheet=t("<style>*{ cursor: "+r.cursor+" !important; }</style>").appendTo(n)),r.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",r.opacity)),r.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",r.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(o=this.containers.length-1;o>=0;o--)this.containers[o]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!r.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,s,o,n,r=this.options,a=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<r.scrollSensitivity?this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop+r.scrollSpeed:e.pageY-this.overflowOffset.top<r.scrollSensitivity&&(this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop-r.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<r.scrollSensitivity?this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft+r.scrollSpeed:e.pageX-this.overflowOffset.left<r.scrollSensitivity&&(this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft-r.scrollSpeed)):(e.pageY-t(document).scrollTop()<r.scrollSensitivity?a=t(document).scrollTop(t(document).scrollTop()-r.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<r.scrollSensitivity&&(a=t(document).scrollTop(t(document).scrollTop()+r.scrollSpeed)),e.pageX-t(document).scrollLeft()<r.scrollSensitivity?a=t(document).scrollLeft(t(document).scrollLeft()-r.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<r.scrollSensitivity&&(a=t(document).scrollLeft(t(document).scrollLeft()+r.scrollSpeed))),a!==!1&&t.ui.ddmanager&&!r.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],o=s.item[0],n=this._intersectsWithPointer(s),n&&s.instance===this.currentContainer&&o!==this.currentItem[0]&&this.placeholder[1===n?"next":"prev"]()[0]!==o&&!t.contains(this.placeholder[0],o)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],o):!0)){if(this.direction=1===n?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var s=this,o=this.placeholder.offset(),n=this.options.axis,r={};n&&"x"!==n||(r.left=o.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),n&&"y"!==n||(r.top=o.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(r,parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,o=s+this.helperProportions.height,n=t.left,r=n+t.width,a=t.top,h=a+t.height,l=this.offset.click.top,c=this.offset.click.left,p="x"===this.options.axis||s+l>a&&h>s+l,u="y"===this.options.axis||e+c>n&&r>e+c,f=p&&u;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?f:e+this.helperProportions.width/2>n&&r>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>a&&h>o-this.helperProportions.height/2},_intersectsWithPointer:function(t){var e="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),s=e&&i,o=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return s?this.floating?n&&"right"===n||"down"===o?2:1:o&&("down"===o?2:1):!1},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return this.floating&&o?"right"===o&&i||"left"===o&&!i:s&&("down"===s&&e||"up"===s&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){a.push(this)}var s,o,n,r,a=[],h=[],l=this._connectWith();if(l&&e)for(s=l.length-1;s>=0;s--)for(n=t(l[s]),o=n.length-1;o>=0;o--)r=t.data(n[o],this.widgetFullName),r&&r!==this&&!r.options.disabled&&h.push([t.isFunction(r.options.items)?r.options.items.call(r.element):t(r.options.items,r.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),r]);for(h.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return t(a)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,s,o,n,r,a,h,l,c=this.items,p=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],u=this._connectWith();if(u&&this.ready)for(i=u.length-1;i>=0;i--)for(o=t(u[i]),s=o.length-1;s>=0;s--)n=t.data(o[s],this.widgetFullName),n&&n!==this&&!n.options.disabled&&(p.push([t.isFunction(n.options.items)?n.options.items.call(n.element[0],e,{item:this.currentItem}):t(n.options.items,n.element),n]),this.containers.push(n));for(i=p.length-1;i>=0;i--)for(r=p[i][1],a=p[i][0],s=0,l=a.length;l>s;s++)h=t(a[s]),h.data(this.widgetName+"-item",r),c.push({item:h,instance:r,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,o,n;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(o=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item,e||(s.width=o.outerWidth(),s.height=o.outerHeight()),n=o.offset(),s.left=n.left,s.top=n.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)n=this.containers[i].element.offset(),this.containers[i].containerCache.left=n.left,this.containers[i].containerCache.top=n.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,s=e.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=e.currentItem[0].nodeName.toLowerCase(),o=t("<"+s+">",e.document[0]).addClass(i||e.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===s?e.currentItem.children().each(function(){t("<td>&#160;</td>",e.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(o)}):"img"===s&&o.attr("src",e.currentItem.attr("src")),i||o.css("visibility","hidden"),o},update:function(t,o){(!i||s.forcePlaceholderSize)&&(o.height()||o.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),o.width()||o.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(s.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),s.placeholder.update(e,e.placeholder)},_contactContainers:function(e){var i,s,o,n,r,a,h,l,c,p,u=null,f=null;for(i=this.containers.length-1;i>=0;i--)if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(u&&t.contains(this.containers[i].element[0],u.element[0]))continue;u=this.containers[i],f=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0);if(u)if(1===this.containers.length)this.containers[f].containerCache.over||(this.containers[f]._trigger("over",e,this._uiHash(this)),this.containers[f].containerCache.over=1);else{for(o=1e4,n=null,c=u.floating||this._isFloating(this.currentItem),r=c?"left":"top",a=c?"width":"height",p=c?"clientX":"clientY",s=this.items.length-1;s>=0;s--)t.contains(this.containers[f].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(h=this.items[s].item.offset()[r],l=!1,e[p]-h>this.items[s][a]/2&&(l=!0),o>Math.abs(e[p]-h)&&(o=Math.abs(e[p]-h),n=this.items[s],this.direction=l?"up":"down"));if(!n&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[f])return;n?this._rearrange(e,n,null,!0):this._rearrange(e,null,this.containers[f].element,!0),this._trigger("change",e,this._uiHash()),this.containers[f]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[f],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[f]._trigger("over",e,this._uiHash(this)),this.containers[f].containerCache.over=1}},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,o=this.options;"parent"===o.containment&&(o.containment=this.helper[0].parentNode),("document"===o.containment||"window"===o.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,t("document"===o.containment?document:window).width()-this.helperProportions.width-this.margins.left,(t("document"===o.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(o.containment)||(e=t(o.containment)[0],i=t(o.containment).offset(),s="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var s="absolute"===e?1:-1,o="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,n=/(html|body)/i.test(o[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():n?0:o.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():n?0:o.scrollLeft())*s}},_generatePosition:function(e){var i,s,o=this.options,n=e.pageX,r=e.pageY,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(a[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(n=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(r=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(n=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(r=this.containment[3]+this.offset.click.top)),o.grid&&(i=this.originalPageY+Math.round((r-this.originalPageY)/o.grid[1])*o.grid[1],r=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-o.grid[1]:i+o.grid[1]:i,s=this.originalPageX+Math.round((n-this.originalPageX)/o.grid[0])*o.grid[0],n=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-o.grid[0]:s+o.grid[0]:s)),{top:r-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:a.scrollTop()),left:n-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:a.scrollLeft())}},_rearrange:function(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var o=this.counter;this._delay(function(){o===this.counter&&this.refreshPositions(!s)})},_clear:function(t,e){function i(t,e,i){return function(s){i._trigger(t,s,e._uiHash(e))}}this.reverting=!1;var s,o=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&o.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||o.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(o.push(function(t){this._trigger("remove",t,this._uiHash())}),o.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),o.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)e||o.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(o.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!e){for(this._trigger("beforeStop",t,this._uiHash()),s=0;o.length>s;s++)o[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}if(e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!e){for(s=0;o.length>s;s++)o[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}})});!function(t){"use strict";var i={},s=Math.max,h=Math.min;i.c={},i.c.d=t(document),i.c.t=function(t){return t.originalEvent.touches.length-1},i.o=function(){var s=this;this.o=null,this.$=null,this.i=null,this.g=null,this.v=null,this.cv=null,this.x=0,this.y=0,this.$c=null,this.c=null,this.t=0,this.isInit=!1,this.fgColor=null,this.pColor=null,this.dH=null,this.cH=null,this.eH=null,this.rH=null,this.run=function(){var i=function(t,i){var h;for(h in i)s.o[h]=i[h];s.init(),s._configure()._draw()};if(!this.$.data("kontroled"))return this.$.data("kontroled",!0),this.extend(),this.o=t.extend({min:this.$.data("min")||0,max:this.$.data("max")||100,stopper:!0,readOnly:this.$.data("readonly"),cursor:this.$.data("cursor")===!0&&30||this.$.data("cursor")||0,thickness:this.$.data("thickness")||.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:null==this.$.data("displayinput")||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inputColor:this.$.data("inputcolor")||this.$.data("fgcolor")||"#87CEEB",inline:!1,step:this.$.data("step")||1,draw:null,change:null,cancel:null,release:null},this.o),this.$.is("fieldset")?(this.v={},this.i=this.$.find("input"),this.i.each(function(i){var h=t(this);s.i[i]=h,s.v[i]=h.val(),h.bind("change",function(){var t={};t[i]=h.val(),s.val(t)})}),this.$.find("legend").remove()):(this.i=this.$,this.v=this.$.val(),""==this.v&&(this.v=this.o.min),this.$.bind("change",function(){s.val(s._validate(s.$.val()))})),!this.o.displayInput&&this.$.hide(),this.$c=t('<canvas width="'+this.o.width+'px" height="'+this.o.height+'px"></canvas>'),this.c=this.$c[0].getContext("2d"),this.$.wrap(t('<div style="'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+'px;"></div>')).before(this.$c),this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=this.v,this.$.bind("configure",i).parent().bind("configure",i),this._listen()._configure()._xy().init(),this.isInit=!0,this._draw(),this},this._draw=function(){var t=!0,i=document.createElement("canvas");i.width=s.o.width,i.height=s.o.height,s.g=i.getContext("2d"),s.clear(),s.dH&&(t=s.dH()),t!==!1&&s.draw(),s.c.drawImage(i,0,0),i=null},this._touch=function(t){var h=function(t){var i=s.xy2val(t.originalEvent.touches[s.t].pageX,t.originalEvent.touches[s.t].pageY);i!=s.cv&&(s.cH&&s.cH(i)===!1||(s.change(s._validate(i)),s._draw()))};return this.t=i.c.t(t),h(t),i.c.d.bind("touchmove.k",h).bind("touchend.k",function(){i.c.d.unbind("touchmove.k touchend.k"),s.rH&&s.rH(s.cv)===!1||s.val(s.cv)}),this},this._mouse=function(t){var h=function(t){var i=s.xy2val(t.pageX,t.pageY);i!=s.cv&&(s.cH&&s.cH(i)===!1||(s.change(s._validate(i)),s._draw()))};return h(t),i.c.d.bind("mousemove.k",h).bind("keyup.k",function(t){if(27===t.keyCode){if(i.c.d.unbind("mouseup.k mousemove.k keyup.k"),s.eH&&s.eH()===!1)return;s.cancel()}}).bind("mouseup.k",function(){i.c.d.unbind("mousemove.k mouseup.k keyup.k"),s.rH&&s.rH(s.cv)===!1||s.val(s.cv)}),this},this._xy=function(){var t=this.$c.offset();return this.x=t.left,this.y=t.top,this},this._listen=function(){return this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(t){t.preventDefault(),s._xy()._mouse(t)}).bind("touchstart",function(t){t.preventDefault(),s._xy()._touch(t)}),this.listen()),this},this._configure=function(){return this.o.draw&&(this.dH=this.o.draw),this.o.change&&(this.cH=this.o.change),this.o.cancel&&(this.eH=this.o.cancel),this.o.release&&(this.rH=this.o.release),this.o.displayPrevious?(this.pColor=this.h2rgba(this.o.fgColor,"0.4"),this.fgColor=this.h2rgba(this.o.fgColor,"0.6")):this.fgColor=this.o.fgColor,this},this._clear=function(){this.$c[0].width=this.$c[0].width},this._validate=function(t){return~~((0>t?-.5:.5)+t/this.o.step)*this.o.step},this.listen=function(){},this.extend=function(){},this.init=function(){},this.change=function(){},this.val=function(){},this.xy2val=function(){},this.draw=function(){},this.clear=function(){this._clear()},this.h2rgba=function(t,i){var s;return t=t.substring(1,7),s=[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)],"rgba("+s[0]+","+s[1]+","+s[2]+","+i+")"},this.copy=function(t,i){for(var s in t)i[s]=t[s]}},i.Dial=function(){i.o.call(this),this.startAngle=null,this.xy=null,this.radius=null,this.lineWidth=null,this.cursorExt=null,this.w2=null,this.PI2=2*Math.PI,this.extend=function(){this.o=t.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:!0},this.o)},this.val=function(t){return null==t?this.v:(this.cv=this.o.stopper?s(h(t,this.o.max),this.o.min):t,this.v=this.cv,this.$.val(this.v),this._draw(),void 0)},this.xy2val=function(t,i){var n,e;return n=Math.atan2(t-(this.x+this.w2),-(i-this.y-this.w2))-this.angleOffset,this.angleArc!=this.PI2&&0>n&&n>-.5?n=0:0>n&&(n+=this.PI2),e=~~(.5+n*(this.o.max-this.o.min)/this.angleArc)+this.o.min,this.o.stopper&&(e=s(h(e,this.o.max),this.o.min)),e},this.listen=function(){var i,n,e=this,a=function(t){t.preventDefault();var i=t.originalEvent,s=i.detail||i.wheelDeltaX,h=i.detail||i.wheelDeltaY,n=parseInt(e.$.val())+(s>0||h>0?e.o.step:0>s||0>h?-e.o.step:0);e.cH&&e.cH(n)===!1||e.val(n)},o=1,l={37:-e.o.step,38:e.o.step,39:e.o.step,40:-e.o.step};this.$.bind("keydown",function(a){var r=a.keyCode;if(r>=96&&105>=r&&(r=a.keyCode=r-48),i=parseInt(String.fromCharCode(r)),isNaN(i)&&(13!==r&&8!==r&&9!==r&&189!==r&&a.preventDefault(),t.inArray(r,[37,38,39,40])>-1)){a.preventDefault();var c=parseInt(e.$.val())+l[r]*o;e.o.stopper&&(c=s(h(c,e.o.max),e.o.min)),e.change(c),e._draw(),n=window.setTimeout(function(){o*=2},30)}}).bind("keyup",function(){isNaN(i)?n&&(window.clearTimeout(n),n=null,o=1,e.val(e.$.val())):e.$.val()>e.o.max&&e.$.val(e.o.max)||e.$.val()<e.o.min&&e.$.val(e.o.min)}),this.$c.bind("mousewheel DOMMouseScroll",a),this.$.bind("mousewheel DOMMouseScroll",a)},this.init=function(){(this.v<this.o.min||this.v>this.o.max)&&(this.v=this.o.min),this.$.val(this.v),this.w2=this.o.width/2,this.cursorExt=this.o.cursor/100,this.xy=this.w2,this.lineWidth=this.xy*this.o.thickness,this.lineCap=this.o.lineCap,this.radius=this.xy-this.lineWidth/2,this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset),this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc),this.angleOffset=this.o.angleOffset*Math.PI/180,this.angleArc=this.o.angleArc*Math.PI/180,this.startAngle=1.5*Math.PI+this.angleOffset,this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var t=s(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.o.width/2+4>>0)+"px",height:(this.o.width/3>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":(this.o.width/3>>0)+"px","margin-left":"-"+(3*this.o.width/4+2>>0)+"px",border:0,background:"none",font:"bold "+(this.o.width/t>>0)+"px Arial","text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})},this.change=function(t){this.cv=t,this.$.val(t)},this.angle=function(t){return(t-this.o.min)*this.angleArc/(this.o.max-this.o.min)},this.draw=function(){var t,i,s=this.g,h=this.angle(this.cv),n=this.startAngle,e=n+h,a=1;s.lineWidth=this.lineWidth,s.lineCap=this.lineCap,this.o.cursor&&(n=e-this.cursorExt)&&(e+=this.cursorExt),s.beginPath(),s.strokeStyle=this.o.bgColor,s.arc(this.xy,this.xy,this.radius,this.endAngle,this.startAngle,!0),s.stroke(),this.o.displayPrevious&&(i=this.startAngle+this.angle(this.v),t=this.startAngle,this.o.cursor&&(t=i-this.cursorExt)&&(i+=this.cursorExt),s.beginPath(),s.strokeStyle=this.pColor,s.arc(this.xy,this.xy,this.radius,t,i,!1),s.stroke(),a=this.cv==this.v),s.beginPath(),s.strokeStyle=a?this.o.fgColor:this.fgColor,s.arc(this.xy,this.xy,this.radius,n,e,!1),s.stroke()},this.cancel=function(){this.val(this.v)}},t.fn.dial=t.fn.knob=function(s){return this.each(function(){var h=new i.Dial;h.o=s,h.$=t(this),h.run()}).parent()}}(jQuery);$(function(){function n(n){return"number"!=typeof n?"":n>=1e9?(n/1e9).toFixed(2)+" GB":n>=1e6?(n/1e6).toFixed(2)+" MB":(n/1e3).toFixed(2)+" KB"}var t=$("#upload ul");$("#drop a.select").click(function(){$(this).parent().find("input").click()}),$("#upload").fileupload({limitConcurrentUploads:1,dropZone:$("#drop"),add:function(e,a){var o=$('<li class="working"><input type="text" value="0" data-width="56" data-height="56" data-fgColor="#0788a5" data-readOnly="1" data-bgColor="#3e4043" /><p></p><span></span></li>');o.find("p").text(a.files[0].name).append("<i>"+n(a.files[0].size)+"</i>"),a.context=o.appendTo(t),o.find("input").knob(),o.find("span").click(function(){o.hasClass("working")&&i.abort(),o.fadeOut(function(){o.remove()})});var i=a.submit()},progress:function(n,t){var e=parseInt(t.loaded/t.total*100,10);t.context.find("input").val(e).change(),100==e&&t.context.removeClass("working")},fail:function(n,t){t.context.addClass("error")}}),$(document).on("drop dragover",function(n){n.preventDefault()})});var QRCode=function(){for(var r=[null,[[10,7,17,13],[1,1,1,1],[]],[[16,10,28,22],[1,1,1,1],[4,16]],[[26,15,22,18],[1,1,2,2],[4,20]],[[18,20,16,26],[2,1,4,2],[4,24]],[[24,26,22,18],[2,1,4,4],[4,28]],[[16,18,28,24],[4,2,4,4],[4,32]],[[18,20,26,18],[4,2,5,6],[4,20,36]],[[22,24,26,22],[4,2,6,6],[4,22,40]],[[22,30,24,20],[5,2,8,8],[4,24,44]],[[26,18,28,24],[5,4,8,8],[4,26,48]],[[30,20,24,28],[5,4,11,8],[4,28,52]],[[22,24,28,26],[8,4,11,10],[4,30,56]],[[22,26,22,24],[9,4,16,12],[4,32,60]],[[24,30,24,20],[9,4,16,16],[4,24,44,64]],[[24,22,24,30],[10,6,18,12],[4,24,46,68]],[[28,24,30,24],[10,6,16,17],[4,24,48,72]],[[28,28,28,28],[11,6,19,16],[4,28,52,76]],[[26,30,28,28],[13,6,21,18],[4,28,54,80]],[[26,28,26,26],[14,7,25,21],[4,28,56,84]],[[26,28,28,30],[16,8,25,20],[4,32,60,88]],[[26,28,30,28],[17,8,25,23],[4,26,48,70,92]],[[28,28,24,30],[17,9,34,23],[4,24,48,72,96]],[[28,30,30,30],[18,9,30,25],[4,28,52,76,100]],[[28,30,30,30],[20,10,32,27],[4,26,52,78,104]],[[28,26,30,30],[21,12,35,29],[4,30,56,82,108]],[[28,28,30,28],[23,12,37,34],[4,28,56,84,112]],[[28,30,30,30],[25,12,40,34],[4,32,60,88,116]],[[28,30,30,30],[26,13,42,35],[4,24,48,72,96,120]],[[28,30,30,30],[28,14,45,38],[4,28,52,76,100,124]],[[28,30,30,30],[29,15,48,40],[4,24,50,76,102,128]],[[28,30,30,30],[31,16,51,43],[4,28,54,80,106,132]],[[28,30,30,30],[33,17,54,45],[4,32,58,84,110,136]],[[28,30,30,30],[35,18,57,48],[4,28,56,84,112,140]],[[28,30,30,30],[37,19,60,51],[4,32,60,88,116,144]],[[28,30,30,30],[38,19,63,53],[4,28,52,76,100,124,148]],[[28,30,30,30],[40,20,66,56],[4,22,48,74,100,126,152]],[[28,30,30,30],[43,21,70,59],[4,26,52,78,104,130,156]],[[28,30,30,30],[45,22,74,62],[4,30,56,82,108,134,160]],[[28,30,30,30],[47,24,77,65],[4,24,52,80,108,136,164]],[[28,30,30,30],[49,25,81,68],[4,28,56,84,112,140,168]]],t=0,e=1,n=2,a=4,o=8,u=/^\d*$/,f=/^[A-Za-z0-9 $%*+\-./:]*$/,i=/^[A-Z0-9 $%*+\-./:]*$/,h=1,s=0,c=3,v=2,l=[],p=[-1],g=0,d=1;255>g;++g)l.push(d),p[d]=g,d=2*d^(d>=128?285:0);for(var m=[[]],g=0;30>g;++g){for(var w=m[g],b=[],x=0;g>=x;++x){var C=g>x?l[w[x]]:0,M=l[(g+(w[x-1]||0))%255];b.push(p[C^M])}m.push(b)}for(var A={},g=0;45>g;++g)A["0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:".charAt(g)]=g;var k=[function(r,t){return(r+t)%2==0},function(r){return r%2==0},function(r,t){return t%3==0},function(r,t){return(r+t)%3==0},function(r,t){return((r/2|0)+(t/3|0))%2==0},function(r,t){return r*t%2+r*t%3==0},function(r,t){return(r*t%2+r*t%3)%2==0},function(r,t){return((r+t)%2+r*t%3)%2==0}],L=function(r){return r>6},y=function(r){return 4*r+17},$=function(t){var e=r[t],n=16*t*t+128*t+64;return L(t)&&(n-=36),e[2].length&&(n-=25*e[2].length*e[2].length-10*e[2].length-55),n},R=function(t,e){var n=-8&$(t),a=r[t];return n-=8*a[0][e]*a[1][e]},E=function(r,t){switch(t){case e:return 10>r?10:27>r?12:14;case n:return 10>r?9:27>r?11:13;case a:return 10>r?8:16;case o:return 10>r?8:27>r?10:12}},H=function(r,t,u){var f=R(r,u)-4-E(r,t);switch(t){case e:return 3*(f/10|0)+(4>f%10?0:7>f%10?1:2);case n:return 2*(f/11|0)+(6>f%11?0:1);case a:return f/8|0;case o:return f/13|0}},N=function(r,t){switch(r){case e:return t.match(u)?t:null;case n:return t.match(f)?t.toUpperCase():null;case a:if("string"==typeof t){for(var o=[],i=0;i<t.length;++i){var h=t.charCodeAt(i);128>h?o.push(h):2048>h?o.push(192|h>>6,128|63&h):65536>h?o.push(224|h>>12,128|h>>6&63,128|63&h):o.push(240|h>>18,128|h>>12&63,128|h>>6&63,128|63&h)}return o}return t}},U=function(r,o,u,f){var i=[],h=0,s=8,c=u.length,v=function(r,t){if(t>=s){for(i.push(h|r>>(t-=s));t>=8;)i.push(r>>(t-=8)&255);h=0,s=8}t>0&&(h|=(r&(1<<t)-1)<<(s-=t))},l=E(r,o);switch(v(o,4),v(c,l),o){case e:for(var p=2;c>p;p+=3)v(parseInt(u.substring(p-2,p+1),10),10);v(parseInt(u.substring(p-2),10),[0,4,7][c%3]);break;case n:for(var p=1;c>p;p+=2)v(45*A[u.charAt(p-1)]+A[u.charAt(p)],11);c%2==1&&v(A[u.charAt(p-1)],6);break;case a:for(var p=0;c>p;++p)v(u[p],8)}for(v(t,4),8>s&&i.push(h);i.length+1<f;)i.push(236,17);return i.length<f&&i.push(236),i},z=function(r,t){for(var e=r.slice(0),n=r.length,a=t.length,o=0;a>o;++o)e.push(0);for(var o=0;n>o;){var u=p[e[o++]];if(u>=0)for(var f=0;a>f;++f)e[o+f]^=l[(u+t[f])%255]}return e.slice(n)},G=function(r,t,e){for(var n=[],a=r.length/t|0,o=0,u=t-r.length%t,f=0;u>f;++f)n.push(o),o+=a;for(var f=u;t>f;++f)n.push(o),o+=a+1;n.push(o);for(var i=[],f=0;t>f;++f)i.push(z(r.slice(n[f],n[f+1]),e));for(var h=[],s=r.length/t|0,f=0;s>f;++f)for(var c=0;t>c;++c)h.push(r[n[c]+f]);for(var c=u;t>c;++c)h.push(r[n[c+1]-1]);for(var f=0;f<e.length;++f)for(var c=0;t>c;++c)h.push(i[c][f]);return h},I=function(r,t,e,n){for(var a=r<<n,o=t-1;o>=0;--o)a>>n+o&1&&(a^=e<<o);return r<<n|a},P=function(t){for(var e=r[t],n=y(t),a=[],o=[],u=0;n>u;++u)a.push([]),o.push([]);var f=function(r,t,e,n,u){for(var f=0;e>f;++f)for(var i=0;n>i;++i)a[r+f][t+i]=u[f]>>i&1,o[r+f][t+i]=1};f(0,0,9,9,[127,65,93,93,93,65,383,0,64]),f(n-8,0,8,9,[256,127,65,93,93,93,65,127]),f(0,n-8,9,8,[254,130,186,186,186,130,254,0,0]);for(var u=9;n-8>u;++u)a[6][u]=a[u][6]=1&~u,o[6][u]=o[u][6]=1;for(var i=e[2],h=i.length,u=0;h>u;++u)for(var s=0==u||u==h-1?1:0,c=0==u?h-1:h,v=s;c>v;++v)f(i[u],i[v],5,5,[31,17,21,17,31]);if(L(t))for(var l=I(t,6,7973,12),p=0,u=0;6>u;++u)for(var v=0;3>v;++v)a[u][n-11+v]=a[n-11+v][u]=l>>p++&1,o[u][n-11+v]=o[n-11+v][u]=1;return{matrix:a,reserved:o}},Q=function(r,t,e){for(var n=r.length,a=0,o=-1,u=n-1;u>=0;u-=2){6==u&&--u;for(var f=0>o?n-1:0,i=0;n>i;++i){for(var h=u;h>u-2;--h)t[f][h]||(r[f][h]=e[a>>3]>>(7&~a)&1,++a);f+=o}o=-o}return r},S=function(r,t,e){for(var n=k[e],a=r.length,o=0;a>o;++o)for(var u=0;a>u;++u)t[o][u]||(r[o][u]^=n(o,u));return r},T=function(r,t,e,n){for(var a=r.length,o=21522^I(e<<3|n,5,1335,10),u=0;15>u;++u){var f=[0,1,2,3,4,5,7,8,a-7,a-6,a-5,a-4,a-3,a-2,a-1][u],i=[a-1,a-2,a-3,a-4,a-5,a-6,a-7,a-8,7,5,4,3,2,1,0][u];r[f][8]=r[8][i]=o>>u&1}return r},Z=function(r){for(var t=3,e=3,n=40,a=10,o=function(r){for(var e=0,a=0;a<r.length;++a)r[a]>=5&&(e+=t+(r[a]-5));for(var a=5;a<r.length;a+=2){var o=r[a];r[a-1]==o&&r[a-2]==3*o&&r[a-3]==o&&r[a-4]==o&&(r[a-5]>=4*o||r[a+1]>=4*o)&&(e+=n)}return e},u=r.length,f=0,i=0,h=0;u>h;++h){var s,c=r[h];s=[0];for(var v=0;u>v;){var l;for(l=0;u>v&&c[v];++l)++v;for(s.push(l),l=0;u>v&&!c[v];++l)++v;s.push(l)}f+=o(s),s=[0];for(var v=0;u>v;){var l;for(l=0;u>v&&r[v][h];++l)++v;for(s.push(l),l=0;u>v&&!r[v][h];++l)++v;s.push(l)}f+=o(s);var p=r[h+1]||[];i+=c[0];for(var v=1;u>v;++v){var g=c[v];i+=g,c[v-1]==g&&p[v]===g&&p[v-1]===g&&(f+=e)}}return f+=a*(Math.abs(i/u/u-.5)/.05|0)},D=function(t,e,n,a,o){var u=r[e],f=U(e,n,t,R(e,a)>>3);f=G(f,u[1][a],m[u[0][a]]);var i=P(e),h=i.matrix,s=i.reserved;if(Q(h,s,f),0>o){S(h,s,0),T(h,s,a,0);var c=0,v=Z(h);for(S(h,s,0),o=1;8>o;++o){S(h,s,o),T(h,s,a,o);var l=Z(h);v>l&&(v=l,c=o),S(h,s,o)}o=c}return S(h,s,o),T(h,s,a,o),h},j={generate:function(r,t){var o={numeric:e,alphanumeric:n,octet:a},f={L:h,M:s,Q:c,H:v};t=t||{};var l=t.version||-1,p=f[(t.ecclevel||"L").toUpperCase()],g=t.mode?o[t.mode.toLowerCase()]:-1,d="mask"in t?t.mask:-1;if(0>g)g="string"==typeof r?r.match(u)?e:r.match(i)?n:a:a;else if(g!=e&&g!=n&&g!=a)throw"invalid or unsupported mode";if(r=N(g,r),null===r)throw"invalid data format";if(0>p||p>3)throw"invalid ECC level";if(0>l){for(l=1;40>=l&&!(r.length<=H(l,g,p));++l);if(l>40)throw"too large data"}else if(1>l||l>40)throw"invalid version";if(-1!=d&&(0>d||d>8))throw"invalid mask";return D(r,l,g,p,d)},generateHTML:function(r,t){t=t||{};for(var e=j.generate(r,t),n=Math.max(t.modulesize||5,.5),a=Math.max(t.margin||4,0),o=document.createElement("div"),u=e.length,f=['<table border="0" cellspacing="0" cellpadding="0" style="border:'+n*a+'px solid #fff;background:#fff">'],i=0;u>i;++i){f.push("<tr>");for(var h=0;u>h;++h)f.push('<td style="width:'+n+"px;height:"+n+"px"+(e[i][h]?";background:#000":"")+'"></td>');f.push("</tr>")}return o.className="qrcode",o.innerHTML=f.join("")+"</table>",o},generatePNG:function(r,t){t=t||{};var e,n=j.generate(r,t),a=Math.max(t.modulesize||5,.5),o=Math.max(t.margin||4,0),u=n.length,f=a*(u+2*o),i=document.createElement("canvas");if(i.width=i.height=f,e=i.getContext("2d"),!e)throw"canvas support is needed for PNG output";e.fillStyle="#fff",e.fillRect(0,0,f,f),e.fillStyle="#000";for(var h=0;u>h;++h)for(var s=0;u>s;++s)n[h][s]&&e.fillRect(a*(o+s),a*(o+h),a,a);return i.toDataURL()}};return j}();var Media=function(){function e(e,i){return e.toLowerCase().indexOf(i.toLowerCase())}function i(i,t){var a=e(i,t),n=t.length;return-1!==a?i.substr(0,a)+('<span class="find">'+i.substr(a,n)+"</span>")+i.substr(a+n):i}function t(t){var t=ivEncodeEntities(t)||"",a=[];for(var n in o)(-1!==e(o[n].title,t)||-1!==e(o[n].desc,t))&&a.push(o[n]);for(var n in r)(-1!==e(r[n].title,t)||-1!==e(r[n].desc,t)||-1!==e(r[n].url,t))&&a.push(r[n]);var l=$.map(a,function(e){var a={};for(var n in e)a[n]=e[n],("title"==n||"desc"==n)&&(a[n]=i(e[n],t||""));return e.title=e.title||"Без имени",Templates("leftBlock",t?a:e)});$("#list").html(l.join("")),$("#list .album").click(function(){m.LoadContent($(this).data("id"))}).each(function(){var e=$(this);e.draggable({appendTo:"#main",start:function(){$("#main").addClass("albumDrag")},stop:function(){$("#main").removeClass("albumDrag")},helper:function(){return'<div class="a-helper">'+e.find("h4").html()+"</div>"}})}),$("#list .gall").click(function(){g.LoadContent($(this).data("id"))}),v.Init("#list .album .cog",["AS","AW","AD","--","AC","GC"],"click"),v.Init("#list .gall .cog",["GS","GW","GD","--","AC","GC"],"click"),v.Init("#list .album",["AS","AW","AD","--","AC","GC"]),v.Init("#list .gall",["GS","GW","GD","--","AC","GC"]);var s=$(".gallery.frame").length>0?!0:!1;s||$(".e.ui-draggable").draggable("disable")}function a(e){var i=function(e){o=e.albums,r=e.gallery,t("")};return e?i(e):Library("Media",{},i)}function n(){$("#right").html(Templates("default")),$("#media").addClass("HideInfo"),$(".new .U").click(f.Open),$(".new .A").click(m.Create),$(".new .G").click(g.Create),v.Init("#list",["AC","GC"])}var o=[],r=[],l=!1,s=[0,0],c=function(e){if(0===e)return{title:"Загруженные фотографии",option:""};if(-1===e)return{aid:-1,title:"Корзина",option:'<a class="waves-button waves-float mini option">Очистить корзину</a>'};for(var i in o)if(o[i].id==e)return o[i].url=location.origin+"/albums/"+parseInt(o[i].id).toString(32),o[i].option="",o[i];return!1},d=function(e){var i=[];return e.find("input, textarea, select").each(function(){i.push($(this).val())}),i},u=function(e){for(var i in r)if(r[i].id==e)return r[i];return!1},f={Open:function(){$("#media").removeClass("HideInfo"),$("#info .upload").addClass("open")},Close:function(){$("#info .upload").removeClass("open")}},m=function(){function e(e,i){var e=e&&e.length?e:d($("#ainfo .sent")),t=i?0:s.id||0;Modal.Close(),Library("AlbumEdit",{aid:t,data:e},function(i){a(i),$(".alb .h h3").html(e[0]),$('.e[data-id="'+t+'"]').addClass("sel")})}function i(e){s&&s.id&&Library("ImagesSort",{aid:s.id,by:e},function(){I(s.id)})}function t(e){if(-1!=s.aid&&(console.log("Поворот изображений: "+e),!($(".background").length>0&&0==$("#cmenu").length))){if($('<div class="background"></div>').appendTo("body"),p.IOpened()){var i=p.IOpened().id,t=[i];$('[data-id="'+i+'"], .cnt').addClass("animate blur "+e)}else{var t=[];$(".image.i").each(function(){var i=$(this).addClass("animate blur "+e).data("id");t.push(i)})}Library("ImagesRotate",{list:t,angle:e,aid:s.id},function(e){r=e.images;for(var t in r)$('[data-id="'+r[t].id+'"]').removeClass("left right animate blur").find("img").attr("src",hard+r[t].src_thumb);i&&($(".view .cnt img").css({display:"none"}),$(".view .cnt img")[0].onload=function(){$(".view *").fadeIn(130)},$(".view .cnt img")[0].src=Picture.Src(u(i)),$(".view .cnt").css(Picture.CSS(u(i))).removeClass("left right animate blur")),$(".background").remove()})}}var r=[],s=!1,u=function(e,i){for(var t in r)if(r[t].id==e)return i?t:r[t];return!1},g=function(){function e(){I.html(""),k.html(""),w.html(""),S.html(""),T.html(""),y.fadeOut(0),s.id>0&&$("#ainfo").fadeIn(0)}function i(i){if(s.id!=i&&c(i)){var t=[];$(".image.i").each(function(e,i){var a=$(i).data("id");t.push(a);var n=[];for(var o in r)r[o].id!=a&&n.push(r[o]);r=n}).remove(),Library("ImagesToAlbum",{aid:i,data:t},function(){}),e()}}function t(t){f.Close(),t||e();var a={count:$(".image.i").length,images:"",achange:'<option value="stop" selected>Переместить в альбом…</option>'};$(o).each(function(){this.id!=s.id&&(a.achange+='<option value="'+this.id+'">'+this.title+"</option>")}),$(".image.i").each(function(e,i){var t=u($(i).data("id"));t&&(a.images='<img class="mini" src="'+hard+t.src_thumb+'" />'+a.images)}),a.sclass="",$(".image.i").length>40&&(a.sclass="p40"),T.html(Templates("imageMultiSelect",a)),$("#ainfo").fadeOut(0),$(".mis .place").change(function(){var e=$(this).val();return $(this).val("stop"),i(e)}),$(".mis .c a.Q").click(b),$(".mis .c a.F").click(h),$(".mis .c a.D").click(function(){i(-1)}),$(".mis .c a.L").click(function(){m.RotateImages("left")}),$(".mis .c a.R").click(function(){m.RotateImages("left")}),t&&($(".mis .selcount, .mis .th").remove(),y.fadeIn(0))}function a(i){e();var a="object"==typeof i?i.id:i,o="EXIF:"+a;if(null==localStorage.getItem(o))return p(o);var r=JSON.parse(localStorage.getItem(o));return r&&r.exif?(d(r.exif),g(r.colors),n(u(a)),$("#ainfo").fadeOut(0),void t(!0)):p(o)}function n(e){S.html('<input type="text" class="form-c" value="'+e.title+'" />'),w.html('<img src="'+hard+(e.src_small?e.src_small:e.src_main)+'" />');var i=e.id;S.find("input").keyup(function(){var e=$(this).val();Stack(function(){Library("ImageRename",{mid:i,title:e},function(e){for(var t in r)r[t].id==i&&(r[t].title=e.title)})},700)})}function d(e){k.html("");for(var i in e)e[i]&&""!=e[i]&&k.append("<p><b>"+i+"</b><span>"+e[i]+"</span></p>")}function g(e){var i="",t=0,a=250;for(var n in e)t+=parseInt(e[n].val);for(var n in e)e[n].W=Math.round(100*e[n].val*a/t)/100,e[n].T="RGB: #"+e[n].color+" ["+e[n].val+"]",i+=Templates("imageColors",e[n]);I.html('<div class="palette">'+i+"</div>"),I.find("a").click(function(e){e.preventDefault();var i=$(this).attr("href");console.log(i)})}function p(e){var i=e.split(":")[1]||e;Library("ImageInfo",{mid:i},function(t){localStorage.setItem(e,JSON.stringify({exif:t.exif,colors:t.colors})),a(i)})}function v(i,n){if(f.Close(),l){if(i.hasClass("i")?$(i).removeClass("i"):$(i).addClass("i"),1==$(".image.i").length)return a($(".image.i").data("id"));if($(".image.i").length>1)return t();e()}else n&&2==n.button&&i.hasClass("i")||($(".image.i").removeClass("i"),$(i).addClass("i"),a(i.data("id")))}function h(){$("#right .image").addClass("i"),t()}function b(){$("#right .image").removeClass("i"),e()}function C(){if(1==$(".image.i").length){var e=u($(".image.i").data("id")),i="";for(var t in e)if("s"==t[0]&&e[t]){var a=Picture.Size(e[t]);i+=Templates("exportImageInput",{w:a[0],h:a[1],src:location.protocol+hard+e[t]})}Modal.Open(Templates("exportImage",{inputs:i}),function(e){e.find(".cancel").click(Modal.Close)},600)}if($(".image.i").length>1){var n=[],o=[];$(".image.i").each(function(){var e=u($(this).data("id"));""==e.src_medium&&(e.src_medium=e.src_large),""==e.src_medium&&(e.src_medium=e.src_main),n.push(location.protocol+hard+e.src_main),o.push(location.protocol+hard+e.src_medium)}),Modal.Open(Templates("exportImages",{main:n.join("\n"),gall:o.join("\n")}),function(e){e.find(".cancel").click(Modal.Close)},600)}}var I=$("#colors"),y=($("#data"),$("#one")),k=$("#meta"),w=$("#thumb"),S=$("#name"),T=$("#multi");return{Click:v,InsertInfo:a,Export:C,Clear:e,ImagesToAlbum:i,Select:h,DSelect:b}}(),p=function(){var e=!1,i=function(e,i){var t=$("#right .image"),a=$("#right .image.i");if(a.length>0)var n=(e?a.slice(-1):$(a[0])).data("id"),o=u(n,i||!1);if(!o)var o=u($(t[0]).data("id"),i||!1);return o},t=function(){$(".view").remove();var t=i();$(".image.i").removeClass("i"),$('[data-id="'+t.id+'"]').addClass("i"),$(Templates("openImage",t)).appendTo("#main"),$(".view .cnt").css(Picture.CSS(t)),$(".view .cnt img")[0].src=Picture.Src(t),$(".view .cnt img")[0].onload=function(){$(".view *").fadeIn(130)},e=t,$(".view .edit a.D").mousedown(function(){ImagesToAlbum(-1),m&&m.View.Close()}),$(".view .edit a.L").mousedown(function(){m.RotateImages("left")}),$(".view .edit a.R").mousedown(function(){m.RotateImages("right")}),$(".view .edit a.X").mousedown(m.View.Close)},a=function(){e&&(u(e.id)&&g.InsertInfo(e.id),e=!1,$(".view").remove())},n=function(i){return void 0!==i?($("#right .image").removeClass("i"),$('[data-id="'+r[i].id+'"]').addClass("i"),e?t():g.InsertInfo(r[i].id)):e?a():void t()},o=function(){if(e){$(".view .cnt").css(Picture.CSS(e));var i=function(){$(".view .cnt img")[0].src=Picture.Src(e),console.log(Picture.Src(e))};Stack(i,300)}},l=function(){var e=parseInt(i(!0,!0)),t=e==r.length-1?0:e+1;n(t)},s=function(){var e=parseInt(i(!1,!0)),t=0==e?r.length-1:e-1;n(t)},c=function(){var e=parseInt(i(!0,!0))-f();n(0>e?0:e)},d=function(){var e=parseInt(i(!1,!0))+f();n(e>r.length-1?r.length-1:e)},f=function(){for(var e=8,i=$("#images .i").width()+e,t=$("#images").width()-14,a=1;t>i;)t-=i,a++;return a-1},p=function(){return e};return{IOpened:p,Space:n,Close:a,Resize:o,Up:c,Down:d,Next:l,Prev:s}}(),h=function(e){var e=e||s.id;console.log("Удаление альбома: "+e),Library("AlbumDelete",{aid:e},function(e){a(e),s&&n()})},b=function(){window.open(s.url)},C=function(e){var i,t=e.tags;r=e.images,$(".e.ui-draggable").draggable("disable");for(var a in r){var n='style="display:none" onload="$(this).fadeIn(300)"';r[a].thumb='<img src="'+hard+r[a].src_thumb+'" '+n+" />",$("#images").append(Templates("eImage",r[a]))}$("#images .image").mousedown(function(e){g.Click($(this),e)}),$(".album").droppable({hoverClass:"image-to-album",drop:function(e,t){i=!0,console.log("IMG: "+t.draggable.context.dataset.id+" to album: "+e.target.dataset.id),g.ImagesToAlbum(e.target.dataset.id)}}),$("#images").sortable({connectWith:".album",helper:"clone",scroll:!1,appendTo:$("#main"),start:function(){i=!1},update:function(){Stack(function(){if(!i){var e=[];$("#images .image").each(function(){e.push($(this).data("id"))}),Library("ImagesSort",{aid:s.id,list:e},function(){console.log("Сортировочка завершена")})}},15)}}),v&&(-1==s.aid?v.Init("#images .image",["IP"]):v.Init("#images .image",["IP","ID","EX","--","IR","IL","--","ISN","ISD","ISI","--","IF","IQ"])),function(){var e=!1,i=$(".tagsinput input"),a=function(){var e=[];return $(".tags .list .f").each(function(){e.push($(this).data("sid"))}),e},n=function(e){$(".tags .list").append(Templates("myFriend",e)),$(".tags .list .f a").click(function(){var e=$(this).data("sid");Library("AlbumTag",{aid:s.id,act:"remove",sid:e}),$('.list [data-sid="'+e+'"]').fadeOut(200,function(){$(this).remove()})})},o=function(){var t=i.val().toUpperCase();if(""==t)return $(".friendsbox").fadeOut();if(e){var o="";for(var r in e)-1!=e[r].name.toUpperCase().indexOf(t)&&-1==a().indexOf(e[r].sid)&&(e[r].i=r,o+=Templates("myFriend",e[r]));o=""==o?'<div class="l">Не найдено</div>':o,$(".friendsbox").html(o).fadeIn(),$(".friendsbox .f").click(function(){var t=e[$(this).data("i")];Library("AlbumTag",{aid:s.id,act:"add",sid:t.sid}),n(t),i.val("")})}};for(var r in t)n(t[r]);i.focus(function(){return e?o():void Library("MyFriends",{},function(i){e=i.friends})}),i.focusout(function(){$(".friendsbox").fadeOut()}),i.keyup(o)}()},I=function(i){return(s=c(i))?(f.Close(),$("#media").removeClass("HideInfo"),$("#right").html(Templates("albumContent",s)),$("#ainfo").html(Templates("editAlbumInfo",s)),$('[name="privacy"]').val(s.privacy),$(".e").removeClass("sel exist"),$('.e[data-id="'+i+'"]').addClass("sel"),g.Clear(),$("#DeleteAlbum").click(h),$("#ViewAlbum").click(b),$("#ainfo select").change(e),$("#ainfo .sent input, #ainfo .sent textarea").keyup(function(){Stack(e,1e3)}),0>=i&&f.Open(),-1==i&&$(".h .option").click(function(){Library("ClearTrash",{},function(){console.log("Корзина очищена"),$("#images > *").fadeOut(100,function(){$(this).remove()})})}),void setTimeout(function(){Library("Images",{aid:i},C)},300)):!1},y=function(){setTimeout(function(){Modal.Open(Templates("createAlbum"),function(i){i.find(".save").click(function(){e(d($(".msg")),!0)}),i.find(".cancel").click(Modal.Close)})},250)};return{LoadContent:I,SortImages:i,RotateImages:t,View:p,Img:g,Create:y,Delete:h}}(),g=function(){function e(e){var e=e&&e.length?e:d($(".settings"));Library("GalleryInfo",{gid:i,data:e},function(t){t.error||($('.e[data-id="'+i+'"]').addClass("sel"),$('.e[data-id="'+i+'"] h4 b').html(e[0]),$('.e[data-id="'+i+'"] p').html(e[2])),i||a()})}var i=!1,t=function(t){var a=u(t);if(!a)return!1;$("#right").html(Templates("galleryContent",a)),$("#media").addClass("HideInfo"),$(".e").removeClass("exist"),$(".e.ui-draggable").draggable("enable"),$(".domain").html("."+host);var n=$(".subdomain input").css({paddingRight:$(".subdomain .domain").width()+7});return n.val(n.val().replace("//","").replace($(".domain").html(),"")),$(".settings select").val(a.privacy),$(".settings select").change(e),$(".settings input, .settings textarea").keyup(function(){Stack(e,1e3)}),$(".gallery .delgal").click(function(){$(".gallery").animate({marginTop:"100%",opacity:0})}),$(".e").removeClass("sel exist"),$('.e[data-id="'+i+'"]').addClass("sel"),!0},o=function(){var e=$(".g-albums .a-cover");$(".g-albums-empty").css({display:e.length>0?"none":"block"})},r=function(e){var t=function(t){var a=c(t);a.img="",a.color="eee";for(var n in e.covers)if(e.covers[n].album==a.id){var r='style="display:none" onload="$(this).fadeIn(300)"';a.img=e.covers[n].src_small,a.img||(a.img=e.covers[n].src_main),a.img='<img src="'+hard+a.img+'" '+r+"/>",a.color=e.covers[n].color}$("#right .g-albums").append(Templates("galleryElement",a));var l=$('.e.ui-draggable[data-id="'+a.id+'"]').draggable("disable").addClass("exist"),s=$('.a-cover[data-id="'+a.id+'"]');return s.find(".del").click(function(){Library("AlbumsInGallery",{gid:i,aid:a.id,remove:!0},function(){s.remove(),l.draggable("enable").removeClass("exist"),o()})}),a};$("#right .g-albums").html("");for(var a in e.albums){{t(e.albums[a].id)}$(".g-albums .drag-helper").css({padding:"8px"})}o(),$(".g-albums").sortable({cancel:".drag-helper",stop:function(){var e={};$(".g-albums .a-cover").each(function(i){e[i]=$(this).data("id")}),Library("AlbumsInGalleryOrder",{gid:i,ordered:e})}}),$("#right .g-albums-dp").droppable({hoverClass:"hover",drop:function(a,n){if(n.draggable.hasClass("e")){var r=n.draggable.data("id");Library("AlbumsInGallery",{gid:i,aid:r},function(i){i.covers[0]&&e.covers.push(i.covers[0]),t(r),o()})}}})},l=function(e){i=e,console.log("Загрузка альбомов галереи: "+e),t(e)&&setTimeout(function(){Library("Albums",{gid:e},r)},300)},s=function(){setTimeout(function(){Modal.Open(Templates("createGallery"),function(i){function t(e){Library("GalleryGetID",{url:e},function(t){if(0===t.result)return i.find(".previewGURL").html([e,location.host].join(".")),void i.find(".save").fadeIn(200);var a=t.result?"URL уже используется":"URL не корректен";i.find(".previewGURL").html("<i>"+a+"</i>"),i.find(".save").fadeOut()})}i.find(".url").keyup(function(){var e=$(this).val();Stack(function(){t(e)},700)}),i.find(".save").click(function(){e(d($(".msg"))),Modal.Close()}),i.find(".cancel").click(Modal.Close)})},250)},f=function(e){var e=e||i;Library("GalleryDelete",{gid:e},function(){a(),i&&n()})};return{LoadContent:l,Create:s,Delete:f}}(),p=function(){var e=function(){var e=[];$(".pfl input, .pfl textarea").each(function(){e.push($(this).val())}),Library("ProfileInfo",{data:e})},i=function(i){i.insocial="";var t={vk:function(e){return"https://vk.com/id"+e},fb:function(e){return"https://facebook.com/profile.php?id="+e},gp:function(e){return"https://plus.google.com/u/0/"+e}};for(var a in i.social){var n=i.social[a].sid;i.social[a].url=t[n.substr(0,2)](n.substr(2)),i.social[a].picture=i.social[a].picture?'<img src="'+i.social[a].picture+'">':"",i.insocial+=Templates("eSocial",i.social[a])}i.cover=i.cover?'<img width="100%" src="'+hard+i.cover+'cover_large.jpg">':"",$("#right").html(Templates("profileContent",i)),$("#media").addClass("HideInfo"),$(".e").removeClass("exist"),$(".e.ui-draggable").draggable("disable"),$(".pfl .url span").html(location.origin+"/");$(".pfl .url input").css({paddingLeft:$(".pfl .url span").width()+8});$(".pfl .ss a").click(OAuth),$(".pfl .c").click(function(){$("#cover-upload").find("input").click()});var l=$(".status"),s=!1;$("#cover-upload").fileupload({dropZone:$(".pfl .c"),add:function(e,i){var t=$("<div/>");t.find("p").text(i.files[0].name).append("<i>"+i.files[0].size+"</i>"),i.context=t.appendTo(l),t.find("input").knob(),t.find("span").click(function(){t.hasClass("working")&&a.abort(),t.fadeOut(t.remove)});var a=i.submit()},progress:function(e,i){var t=parseInt(i.loaded/i.total*100,10);$(".pfl .status i").css({width:t+"%"}),s=i},stop:function(){var e=hard+s.result+"cover_large.jpg";$(".pfl .c img").attr("src",e+"?"+Math.random()),$(".pfl .status i").css({width:0})}}),$(document).on("drop dragover",function(e){e.preventDefault()}),console.log(o),console.log(r),console.log(i),$(".pfl input, .pfl textarea").keyup(function(){Stack(e,1e3)}),Waves.displayEffect()},t=function(){console.log("Загрузка информации профиля"),Library("Profile",{},i)};return t}(),v=function(){function e(e,t,a){$(e).map(function(){$(this).bind(a?a:"contextmenu",function(e){return e.preventDefault(),n=e,i(t),!1})})}function i(e){a.append(Templates("contextMenu")),$("#cMenuBG").click(t);var i=$("#cmenu");for(var r in e){var l="<a onclick=\"Media.Context.Acts('"+e[r]+"')\">"+o[e[r]][0]+"</a>";o[e[r]][1]||(l='<a class="t"></a>'),$("<li>"+l+"</li>").appendTo(i)}var s=n.clientX,c=n.clientY;c+$("#cmenu").height()>document.height&&(c=c-$("#cmenu").height()-10),i.css({left:s,top:c}),console.log([$("#cmenu").height(),document.height,1])}function t(){$("#cmenu, #cMenuBG").fadeOut(200),setTimeout(function(){$("#cmenu, #cMenuBG").remove()},201)}var a=$("#main"),n=!1,o={"--":["",!1],AS:["Подробнее",function(){m.LoadContent(n.currentTarget.dataset.id)}],AW:["Просмотр альбома (в новом окне)",function(){window.open(c(n.currentTarget.dataset.id).url)}],AD:["Удалить альбом",function(){m.Delete(n.currentTarget.dataset.id)}],AC:["Создать новый альбом",m.Create],GS:["Подробнее",function(){g.LoadContent(n.currentTarget.dataset.id)}],GW:["Просмотр галереи (в новом окне)",function(){window.open("http://"+u(n.currentTarget.dataset.id).url+"."+location.host)}],GD:["Удалить галерею",function(){g.Delete(n.currentTarget.dataset.id)}],EX:["Экспорт",m.Img.Export],GC:["Создать новую галерею",g.Create],IP:["Просмотр",m.View.Space],IF:["Выделить все фотографии",m.Img.Select],IQ:["Отменить выбор фотографий",m.Img.DSelect],ID:["Удалить выделенные фотографии",function(){m.Img.ImagesToAlbum(-1)}],IR:["Повернуть направо",function(){m.RotateImages("right")}],IL:["Повернуть налево",function(){m.RotateImages("left")}],ISD:["Сортировать по дате",function(){m.SortImages("date")}],ISN:["Сортировать по инмеи",function(){m.SortImages("name")}],ISI:["Инвертировать порядок",function(){m.SortImages("invert")}]};return{Close:t,Init:e,Open:i,Acts:function(e){return t(),o[e][1]()}}}();return a(),n(),$("#search input").keyup(function(){t($(this).val())}),$("#left .ctrls span.k").mousedown(function(){m.LoadContent(-1)}),$("#left .ctrls span.i").mousedown(function(){m.LoadContent(0)}),$("#left .ctrls span.p").mousedown(p),$("#info .ctrls .down").mousedown(f.Open),$("#info .upload .close").mousedown(f.Close),$(document).keydown(function(e){-1!=[17,16,91].indexOf(e.keyCode)&&(l=!0)}),$(document).keyup(function(e){-1!=[17,16,91].indexOf(e.keyCode)&&(l=!1)}),$(document).keydown(function(e){v.Close(),$("input:focus, textarea:focus").length>0||(e.preventDefault(),$(".background").length>0||(27==e.keyCode&&m.View.Close(),32==e.keyCode&&m.View.Space(),38==e.keyCode&&m.View.Up(),37==e.keyCode&&m.View.Prev(),39==e.keyCode&&m.View.Next(),40==e.keyCode&&m.View.Down(),70==e.keyCode&&m.Img.Select(),81==e.keyCode&&m.Img.DSelect(),219==e.keyCode&&m.RotateImages("left"),221==e.keyCode&&m.RotateImages("right"),-1!=[46,68,8].indexOf(e.keyCode)&&(m.Img.ImagesToAlbum(-1),m.View.Close()),console.log(e.keyCode)))}),$(window).resize(function(){m.View.Resize()}),Waves.displayEffect(),document.onmousemove=function(e){s=[e.pageX,e.pageY]},{Context:v}}();